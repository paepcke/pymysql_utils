<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>pymysql_utilsTmp API documentation</title>
    <meta name="description" content="Created on Sep 24, 2013
</br>@author: paepcke
</br>Modifications:
  - Dec 30, 2013: Added closing of..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#pymysql_utilsTmp.no_db_warnings">no_db_warnings</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.no_warn_dup_key">no_warn_dup_key</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.no_warn_no_table">no_warn_no_table</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#pymysql_utilsTmp.Cursors">Cursors</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#pymysql_utilsTmp.DupKeyAction">DupKeyAction</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#pymysql_utilsTmp.MySQLDB">MySQLDB</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.__init__">__init__</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.bulkInsert">bulkInsert</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.close">close</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.convert_to_string">convert_to_string</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.createTable">createTable</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.dbName">dbName</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.dropTable">dropTable</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.execute">execute</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.executeParameterized">executeParameterized</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.insert">insert</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.isOpen">isOpen</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.query">query</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.query_exhausted">query_exhausted</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.result_count">result_count</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.truncateTable">truncateTable</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.update">update</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.MySQLDB.find_mysql_path">find_mysql_path</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pymysql_utilsTmp.QueryResult">QueryResult</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pymysql_utilsTmp.QueryResult.__init__">__init__</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.QueryResult.next">next</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.QueryResult.nextall">nextall</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.QueryResult.query_str">query_str</a></li>
    <li class="mono"><a href="#pymysql_utilsTmp.QueryResult.result_count">result_count</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">pymysql_utilsTmp</span> module</h1>
  <p>Created on Sep 24, 2013
</br>@author: paepcke
</br>Modifications:
  - Dec 30, 2013: Added closing of connection to close() method
  - Mar 26, 2017: Major overhaul; fixed bulk insert.
</br>For usage details, see <code>Github README &lt;https://github.com/paepcke/pymysql_utils&gt;</code>_.
This module is designed for MySQL 5.6 and 5.7. 
 </br></p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp" class="source">
    <div class="codehilite"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Created on Sep 24, 2013</span>
<span class="sd">&lt;/br&gt;@author: paepcke</span>
<span class="sd">&lt;/br&gt;Modifications:</span>
<span class="sd">  - Dec 30, 2013: Added closing of connection to close() method</span>
<span class="sd">  - Mar 26, 2017: Major overhaul; fixed bulk insert.</span>
<span class="sd">&lt;/br&gt;For usage details, see `Github README &lt;https://github.com/paepcke/pymysql_utils&gt;`_.</span>
<span class="sd">This module is designed for MySQL 5.6 and 5.7. </span>
<span class="sd"> &lt;/br&gt;&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">filterwarnings</span><span class="p">,</span> <span class="n">resetwarnings</span>


<span class="kn">import</span> <span class="nn">MySQLdb</span>
<span class="kn">from</span> <span class="nn">MySQLdb</span> <span class="kn">import</span> <span class="ne">Warning</span> <span class="k">as</span> <span class="n">db_warning</span>
<span class="kn">from</span> <span class="nn">MySQLdb._exceptions</span> <span class="kn">import</span> <span class="n">ProgrammingError</span><span class="p">,</span> <span class="n">OperationalError</span>
<span class="kn">from</span> <span class="nn">MySQLdb.cursors</span> <span class="kn">import</span> <span class="n">DictCursor</span> <span class="k">as</span> <span class="n">DictCursor</span>
<span class="kn">from</span> <span class="nn">MySQLdb.cursors</span> <span class="kn">import</span> <span class="n">SSCursor</span> <span class="k">as</span> <span class="n">SSCursor</span>
<span class="kn">from</span> <span class="nn">MySQLdb.cursors</span> <span class="kn">import</span> <span class="n">SSDictCursor</span> <span class="k">as</span> <span class="n">SSDictCursor</span>

<span class="c1"># To check for variable being a string in both Python 2.7 and 3.x:</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;basestring&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="c1"># We are running Python 3:</span>
    <span class="nb">basestring</span> <span class="o">=</span> <span class="nb">str</span>

<span class="k">class</span> <span class="nc">DupKeyAction</span><span class="p">:</span>
    <span class="n">PREVENT</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">IGNORE</span>  <span class="o">=</span> <span class="mi">1</span>
    <span class="n">REPLACE</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Cursor classes as per: </span>
<span class="c1">#    http://mysql-python.sourceforge.net/MySQLdb-1.2.2/public/MySQLdb.cursors.BaseCursor-class.html</span>
<span class="c1"># Used to pass to query() method if desired:   </span>

<span class="k">class</span> <span class="nc">Cursors</span><span class="p">:</span>
    <span class="n">BASIC</span>           <span class="o">=</span> <span class="bp">None</span>
    <span class="n">DICT</span>            <span class="o">=</span> <span class="n">DictCursor</span>
    <span class="n">SS_CURSOR</span>       <span class="o">=</span> <span class="n">SSCursor</span>
    <span class="n">SS_DICT_CURSOR</span>  <span class="o">=</span> <span class="n">SSDictCursor</span>
                      
<span class="k">class</span> <span class="nc">MySQLDB</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Shallow interface to MySQL databases. Some niceties nonetheless.</span>
<span class="sd">      - The query() method is an iterator. So::</span>
<span class="sd">            for result in db.query(&#39;SELECT * FROM foo&#39;):</span>
<span class="sd">               print result</span>
<span class="sd">      - Table manipulations (create/drop/...)</span>
<span class="sd">      - Insertion/update</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">NON_ASCII_CHARS_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\x00-\x7F]+&#39;</span><span class="p">)</span>

    <span class="c1"># ----------------------- Top-Level Housekeeping -------------------------</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># Constructor</span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> 
                 <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span> 
                 <span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> 
                 <span class="n">passwd</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> 
                 <span class="n">db</span><span class="o">=</span><span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
                 <span class="n">cursor_class</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates connection to the underlying MySQL database.</span>
<span class="sd">        This connection is maintained until method close()</span>
<span class="sd">        is called. The optional cursor_class controls the</span>
<span class="sd">        format in which query results are returned. The </span>
<span class="sd">        Values must be one of Cursors.DICT, Cursors.SS_CURSOR,</span>
<span class="sd">        etc. See definition of class Cursors above. </span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;host&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): MySQL host&lt;/br&gt;        &lt;b&gt;port&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;int&lt;/i&gt;&lt;/b&gt;): MySQL host&#39;s port&lt;/br&gt;        &lt;b&gt;user&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): user to log in as&lt;/br&gt;        &lt;b&gt;passwd&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): password to use for given user&lt;/br&gt;        &lt;b&gt;db&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): database to connect to within server&lt;/br&gt;        &lt;b&gt;cursor_class&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;Cursors&lt;/i&gt;&lt;/b&gt;): choice of how rows are returned&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; RuntimeError if mysql client program not found.&lt;/br&gt;    &lt;/br&gt;        &#39;&#39;&#39;</span>
        
        <span class="c1"># If all arguments are set to None, we are unittesting:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">arg</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">passwd</span><span class="p">,</span><span class="n">db</span><span class="p">)):</span>
            <span class="k">return</span>
        
        <span class="c1"># However, cannot have any of the connection parms None.</span>
        <span class="c1"># Get a list of parameter names whose values are None:</span>
        <span class="n">potential_offenders</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">({</span><span class="s1">&#39;host&#39;</span> <span class="p">:</span> <span class="n">host</span><span class="p">,</span>
                                           <span class="s1">&#39;db&#39;</span> <span class="p">:</span> <span class="n">db</span><span class="p">,</span> 
                                           <span class="s1">&#39;user&#39;</span> <span class="p">:</span> <span class="n">user</span><span class="p">,</span> 
                                           <span class="s1">&#39;passwd&#39;</span> <span class="p">:</span> <span class="n">passwd</span><span class="p">,</span> 
                                           <span class="s1">&#39;port&#39;</span> <span class="p">:</span> <span class="n">port</span><span class="p">}</span>
                                          <span class="p">)</span>
        <span class="n">bad_parms</span> <span class="o">=</span> <span class="p">[</span><span class="n">none_parms</span> <span class="k">for</span> <span class="n">none_parms</span> <span class="ow">in</span> <span class="n">potential_offenders</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">potential_offenders</span><span class="p">[</span><span class="n">none_parms</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">]</span>
        <span class="c1"># If &#39;host&#39; and &#39;user&#39; are None, we now have: [&#39;host&#39;, &#39;user&#39;]</span>
        <span class="c1"># If none of the above parms is None, non_parms will be empty:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bad_parms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;None value(s) for </span><span class="si">%s</span><span class="s1">; none of host,port,user,passwd or db must be None&#39;</span> <span class="o">%</span> <span class="n">bad_parms</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cursor_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># Ensure we caller passed a valid cursor class:</span>
            <span class="k">if</span> <span class="n">cursor_class</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">DictCursor</span><span class="p">,</span> <span class="n">SSCursor</span><span class="p">,</span> <span class="n">SSDictCursor</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Non-existing cursor class &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">cursor_class</span><span class="p">))</span>
        
        <span class="c1"># Ensure proper data types: all but port must be strings:</span>
        <span class="k">del</span> <span class="n">potential_offenders</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span>
        
        <span class="n">type_offenders</span> <span class="o">=</span> <span class="p">[</span><span class="n">bad_type_parms</span> <span class="k">for</span> <span class="n">bad_type_parms</span> <span class="ow">in</span> <span class="n">potential_offenders</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 
                          <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">potential_offenders</span><span class="p">[</span><span class="n">bad_type_parms</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">]</span>
        
        <span class="c1"># OK for port to be an int:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_offenders</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Value(s) </span><span class="si">%s</span><span class="s1"> have bad type;host,user,passwd, and db must be strings; port must be int.&#39;</span> 
                             <span class="o">%</span> <span class="n">type_offenders</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Port must be an integer; was </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwd</span>  <span class="o">=</span> <span class="n">passwd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span>   <span class="o">=</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">db</span>
        <span class="c1"># Will hold querySt-&gt;cursor for two purposes:</span>
        <span class="c1"># Ability to retrieve number of results in SELECT,</span>
        <span class="c1"># Ensure that all cursors are closed (see query()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">most_recent_query</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="c1"># Find location of mysql client program.</span>
        <span class="c1"># Will raise error if not found.</span>
        <span class="n">MySQLDB</span><span class="o">.</span><span class="n">find_mysql_path</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cursor_class</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
                                                  <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> 
                                                  <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> 
                                                  <span class="n">passwd</span><span class="o">=</span><span class="n">passwd</span><span class="p">,</span> 
                                                  <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
                                                  <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
                                                  <span class="n">local_infile</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> 
                                                  <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> 
                                                  <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> 
                                                  <span class="n">passwd</span><span class="o">=</span><span class="n">passwd</span><span class="p">,</span> 
                                                  <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
                                                  <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
                                                  <span class="n">cursorclass</span><span class="o">=</span><span class="n">cursor_class</span><span class="p">,</span>
                                                  <span class="n">local_infile</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">except</span> <span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">pwd</span> <span class="o">=</span> <span class="s1">&#39;...............&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">passwd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&lt;no password&gt;&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot reach MySQL server with host:</span><span class="si">%s</span><span class="s1">, port:</span><span class="si">%s</span><span class="s1">, user:</span><span class="si">%s</span><span class="s1">, pwd:</span><span class="si">%s</span><span class="s1">, db:</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
        <span class="c1"># Unanticipated errors:</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">pwd</span> <span class="o">=</span> <span class="s1">&#39;...............&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">passwd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&lt;no password&gt;&#39;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Error when connecting to database with host:</span><span class="si">%s</span><span class="s1">, port:</span><span class="si">%s</span><span class="s1">, user:</span><span class="si">%s</span><span class="s1">, pwd:</span><span class="si">%s</span><span class="s1">, db:</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
      

    <span class="c1">#-------------------------</span>
    <span class="c1"># dbName </span>
    <span class="c1">#--------------</span>
        
    <span class="k">def</span> <span class="nf">dbName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return name of database to which this MySQLDB is connected.</span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; name of database within MySQL server to which MySQLDB instance is connected.&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; String&lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span>
    
    <span class="c1">#-------------------------</span>
    <span class="c1"># close </span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Close all cursors that are currently still open.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># isOpen</span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">isOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns True if the connection to the databases</span>
<span class="sd">        is open. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">open</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
      
    <span class="c1"># ----------------------- Table Management -------------------------</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># createTable</span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">createTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableName</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">temporary</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create new table, given its name, and schema.</span>
<span class="sd">        The schema is a dict mappingt column names to </span>
<span class="sd">        column types. Example: {&#39;col1&#39; : &#39;INT&#39;, &#39;col2&#39; : &#39;TEXT&#39;}</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;tableName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of new table&lt;/br&gt;        &lt;b&gt;schema&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;Dict&lt;String,String&gt;&lt;/i&gt;&lt;/b&gt;): dictionary mapping column names to column types&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError: if table to truncate does not exist or permissions issues.&lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="n">colSpec</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">colName</span><span class="p">,</span> <span class="n">colVal</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">colSpec</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">colVal</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;CREATE </span><span class="si">%s</span><span class="s1"> TABLE IF NOT EXISTS </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">) &#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="s1">&#39;TEMPORARY&#39;</span> <span class="k">if</span> <span class="n">temporary</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="n">tableName</span><span class="p">,</span> 
            <span class="n">colSpec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># dropTable</span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">dropTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableName</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Delete table safely. No errors</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;tableName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of table&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError: if table to drop does not exist or permissions issues.&lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Suppress warning about table not existing:</span>
            <span class="k">with</span> <span class="n">no_warn_no_table</span><span class="p">():</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DROP TABLE IF EXISTS </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tableName</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In pymysql_utils dropTable(): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ProgrammingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In pymysql_utils dropTable(): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># truncateTable </span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">truncateTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableName</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Delete all table rows. No errors</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;tableName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of table&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError: if table to truncate does not exist or permissions issues.&lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;TRUNCATE TABLE </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tableName</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In pymysql_utils truncateTable(): </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">ProgrammingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In pymysql_utils truncateTable(): </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># ----------------------- Insertion and Updates -------------------------</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># insert </span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tblName</span><span class="p">,</span> <span class="n">colnameValueDict</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Given a dictionary mapping column names to column values,</span>
<span class="sd">        insert the data into a specified table</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;tblName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of table to insert into&lt;/br&gt;        &lt;b&gt;colnameValueDict&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;Dict&lt;String,Any&gt;&lt;/i&gt;&lt;/b&gt;): mapping of column name to column value&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; (None,None) if all ok, else tuple (errorList, warningsList)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ({ (str) | None},{ (str) | None})}&lt;/br&gt;        &#39;&#39;&#39;</span>

        <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">colNames</span><span class="p">,</span> <span class="n">colValues</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">colnameValueDict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wellTypedColValues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensureSQLTyping</span><span class="p">(</span><span class="n">colValues</span><span class="p">)</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;INSERT INTO </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">) VALUES (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tblName</span><span class="p">),</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">colNames</span><span class="p">),</span> <span class="n">wellTypedColValues</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># The following show_warnings() will</span>
                    <span class="c1"># reveal the error:</span>
                    <span class="k">pass</span>
            <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
                <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>                
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>            
    
    <span class="c1">#-------------------------</span>
    <span class="c1"># bulkInsert </span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">bulkInsert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tblName</span><span class="p">,</span> <span class="n">colNameTuple</span><span class="p">,</span> <span class="n">valueTupleArray</span><span class="p">,</span> <span class="n">onDupKey</span><span class="o">=</span><span class="n">DupKeyAction</span><span class="o">.</span><span class="n">PREVENT</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Inserts large number of rows into given table. The</span>
<span class="sd">        rows must be provided as an array of tuples. Caller&#39;s</span>
<span class="sd">        choice whether duplicate keys should cause a warning,</span>
<span class="sd">        omitting the incoming row, omit the incoming row without</span>
<span class="sd">        a warning, or replace the existing row.</span>
<span class="sd">        &lt;/br&gt;        Returns None if all went well, else a list of error</span>
<span class="sd">        tuples.</span>
<span class="sd">        &lt;/br&gt;        Strategy: </span>
<span class="sd">        &lt;/br&gt;        write the values to a temp file, then generate a </span>
<span class="sd">        ``LOAD LOCAL INFILE...`` MySQL command and execute it in MySQL. </span>
<span class="sd">        Returns `None` if no errors/warnings, else returns the tuple</span>
<span class="sd">        of tuples with the warnings.</span>
<span class="sd">                &lt;/br&gt;        &lt;b&gt;tblName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): table into which to insert&lt;/br&gt;        &lt;b&gt;colNameTuple&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;(str[,str[...]])&lt;/i&gt;&lt;/b&gt;): tuple containing column names in proper order, i.e. corresponding to valueTupleArray orders.&lt;/br&gt;        &lt;b&gt;valueTupleArray&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;`[(&lt;MySQLVal&gt; [,&lt;MySQLval&gt;,...]])`&lt;/i&gt;&lt;/b&gt;): array of n-tuples, which hold the values. Order of values must correspond to order of column names in colNameTuple.&lt;/br&gt;        &lt;b&gt;onDupKey&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;DupKeyAction&lt;/i&gt;&lt;/b&gt;): determines action when incoming row would duplicate an existing row&#39;s unique key. If set to DupKeyAction.IGNORE, then the incoming tuple is skipped. If set to DupKeyAction.REPLACE, then the incoming tuple replaces the existing tuple. By default, each attempt to insert a duplicate key generates a warning.&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt;                             &lt;/br&gt;(None,None) is no errors or warnings occurred, else a tuple with (errorList, warningsList). Elements of warningsList reflect MySQL&#39;s output of &quot;show warnings;&quot; Example:: ((u&#39;Warning&#39;, 1062L, u&quot;Duplicate entry &#39;10&#39; for key &#39;PRIMARY&#39;&quot;),)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ({ (str) | None},{ (str) | None})}&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError if bad parameter.&lt;/br&gt;        &lt;/br&gt;        &#39;&#39;&#39;</span>

        <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">tmpCSVFile</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;bulkInsert&#39;</span><span class="p">,</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="c1"># Allow MySQL to read this tmp file:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">tmpCSVFile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="n">o644</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csvWriter</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">tmpCSVFile</span><span class="p">,</span> 
                                    <span class="n">dialect</span><span class="o">=</span><span class="s1">&#39;excel-tab&#39;</span><span class="p">,</span> 
                                    <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> 
                                    <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> 
                                    <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> 
                                    <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_MINIMAL</span><span class="p">)</span>
        <span class="c1"># Can&#39;t use csvWriter.writerows() b/c some rows have </span>
        <span class="c1"># weird chars: self.csvWriter.writerows(valueTupleArray)        </span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">valueTupleArray</span><span class="p">:</span>
            <span class="c1"># Convert each element in row to a string,</span>
            <span class="c1"># including mixed-in Unicode Strings:</span>
            <span class="n">clean_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">rowElement</span> <span class="k">for</span> <span class="n">rowElement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stringifyList</span><span class="p">(</span><span class="n">row</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csvWriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">clean_row</span><span class="p">)</span>
        <span class="n">tmpCSVFile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        
        <span class="c1"># Create the MySQL column name list needed in the LOAD INFILE below.</span>
        <span class="c1"># We need &#39;(colName1,colName2,...)&#39;:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colNameTuple</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">colSpec</span> <span class="o">=</span> <span class="s1">&#39;()&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colSpec</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">colNameTuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">colName</span> <span class="ow">in</span> <span class="n">colNameTuple</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">colSpec</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">colName</span>
            <span class="n">colSpec</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

        <span class="c1"># For warnings from MySQL:</span>
        <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">onDupKey</span> <span class="o">==</span> <span class="n">DupKeyAction</span><span class="o">.</span><span class="n">PREVENT</span><span class="p">:</span>
                <span class="n">dupAction</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># trigger the MySQL default</span>
            <span class="k">elif</span> <span class="n">onDupKey</span> <span class="o">==</span> <span class="n">DupKeyAction</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">:</span>
                <span class="n">dupAction</span> <span class="o">=</span> <span class="s1">&#39;IGNORE&#39;</span>
            <span class="k">elif</span> <span class="n">onDupKey</span> <span class="o">==</span> <span class="n">DupKeyAction</span><span class="o">.</span><span class="n">REPLACE</span><span class="p">:</span>
                <span class="n">dupAction</span> <span class="o">=</span> <span class="s1">&#39;REPLACE&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Parameter onDupKey to bulkInsert method must be of type DupKeyAction; is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">onDupKey</span><span class="p">))</span>
            
            <span class="c1"># Remove quotes from the values inside the colNameTuple&#39;s:</span>
            <span class="n">mySQLCmd</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;LOAD DATA LOCAL INFILE &#39;</span><span class="si">%s</span><span class="s2">&#39; </span><span class="si">%s</span><span class="s2"> INTO TABLE </span><span class="si">%s</span><span class="s2"> FIELDS TERMINATED BY &#39;,&#39; &quot;</span> <span class="o">+</span>\
                        <span class="s2">&quot;OPTIONALLY ENCLOSED BY &#39;</span><span class="se">\&quot;</span><span class="s2">&#39; ESCAPED BY &#39;</span><span class="se">\\\\</span><span class="s2">&#39; LINES TERMINATED BY &#39;</span><span class="se">\\</span><span class="s2">n&#39; </span><span class="si">%s</span><span class="s2">&quot;</span>
                        <span class="p">)</span> <span class="o">%</span>  <span class="p">(</span><span class="n">tmpCSVFile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dupAction</span><span class="p">,</span> <span class="n">tblName</span><span class="p">,</span> <span class="n">colSpec</span><span class="p">)</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">mySQLCmd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># The following show_warnings() will</span>
                    <span class="c1"># reveal the error:</span>
                    <span class="k">pass</span>
            <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
                <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tmpCSVFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;commit;&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>            
    
    <span class="c1">#-------------------------</span>
    <span class="c1"># update </span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tblName</span><span class="p">,</span> <span class="n">colName</span><span class="p">,</span> <span class="n">newVal</span><span class="p">,</span> <span class="n">fromCondition</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update one column with a new value.</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;tblName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of table in which update is to occur&lt;/br&gt;        &lt;b&gt;colName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): column whose value is to be changed&lt;/br&gt;        &lt;b&gt;newVal&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;type acceptable to MySQL for the given column&lt;/i&gt;&lt;/b&gt;): value acceptable to MySQL for the given column&lt;/br&gt;        &lt;b&gt;fromCondition&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): optionally condition that selects which rows to update. if None, the named column in all rows are updated to the given value. Syntax must conform to what may be in a MySQL FROM clause (don&#39;t include the &#39;FROM&#39; keyword)&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; (None,None) if all ok, else tuple (errorList, warningsList)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ([str],[str])}&lt;/br&gt;        &#39;&#39;&#39;</span>

        <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fromCondition</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">newVal</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c1"># The double-% causes the &#39;%s&#39; to be retained</span>
                    <span class="c1"># in the update string. The underlying mysqldb</span>
                    <span class="c1"># package will substitute that later for None.</span>
                    <span class="c1"># I.e.: create a two-tuple:</span>
                    <span class="c1">#</span>
                    <span class="c1">#   (&#39;UPDATE unittest SET col1 = %s&#39;, (None,))</span>
                    <span class="c1">#</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;UPDATE </span><span class="si">%s</span><span class="s2"> SET </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%%</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tblName</span><span class="p">,</span><span class="n">colName</span><span class="p">),</span> <span class="p">(</span><span class="bp">None</span><span class="p">,))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;UPDATE </span><span class="si">%s</span><span class="s2"> SET </span><span class="si">%s</span><span class="s2"> = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tblName</span><span class="p">,</span><span class="n">colName</span><span class="p">,</span><span class="n">newVal</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">newVal</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c1"># See above for explanation of double-%:</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;UPDATE </span><span class="si">%s</span><span class="s2"> SET </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%%</span><span class="s2">s WHERE </span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tblName</span><span class="p">,</span><span class="n">colName</span><span class="p">,</span><span class="n">fromCondition</span><span class="p">),</span> <span class="p">(</span><span class="bp">None</span><span class="p">,))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;UPDATE </span><span class="si">%s</span><span class="s2"> SET </span><span class="si">%s</span><span class="s2"> = &#39;</span><span class="si">%s</span><span class="s2">&#39; WHERE </span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tblName</span><span class="p">,</span><span class="n">colName</span><span class="p">,</span><span class="n">newVal</span><span class="p">,</span><span class="n">fromCondition</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># If setting to None, cmd will be a tuple</span>
                    <span class="c1"># with the %s-notation UPDATE string first,</span>
                    <span class="c1"># and the values second:</span>
                    <span class="k">if</span> <span class="n">newVal</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># The following show_warnings() will</span>
                    <span class="c1"># reveal the error:</span>
                    <span class="k">pass</span>
            <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
                <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>            
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>            

    <span class="c1"># ----------------------- Queries -------------------------</span>
        
    <span class="c1">#-------------------------</span>
    <span class="c1"># query </span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryStr</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Query iterator. Given a query, return one result for each</span>
<span class="sd">        subsequent call. When all results have been retrieved,</span>
<span class="sd">        the iterator returns None.</span>
<span class="sd">        &lt;/br&gt;        IMPORTANT: what is returned is an *iterator*. So you</span>
<span class="sd">        need to call next() to get the first result, even if</span>
<span class="sd">        there is only one.</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;queryStr&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): the query to submit to MySQL&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; iterator of query results&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; iterator of tuples&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError on MySQL errors.&lt;/br&gt;        &#39;&#39;&#39;</span>

        <span class="c1"># The str/byte/unicode type mess between</span>
        <span class="c1"># Python 2.7 and 3.x. We want as &#39;normal&#39;</span>
        <span class="c1"># a string as possible. Surely there is a</span>
        <span class="c1"># more elegant way:</span>
        
        <span class="n">queryStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_string</span><span class="p">(</span><span class="n">queryStr</span><span class="p">)</span>
       
        <span class="c1"># For if caller never exhausts the results by repeated calls,</span>
        <span class="c1"># and to find cursor by query to get (e.g.) num results:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        
        <span class="c1"># Ability to find an active cursor by query </span>
        <span class="c1"># via result_count(queryString)...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="n">queryStr</span><span class="p">]</span> <span class="o">=</span> <span class="n">cursor</span>
        
        <span class="c1">#... or find it via  result_count()...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">most_recent_query</span> <span class="o">=</span> <span class="n">queryStr</span>

        <span class="k">try</span><span class="p">:</span>        
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">queryStr</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ProgrammingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">QueryResult</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">queryStr</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        
    <span class="c1">#-------------------------</span>
    <span class="c1"># result_count </span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">result_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryStr</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Given a query string, after that string served</span>
<span class="sd">        as query in a call to query(), and before the result iterator</span>
<span class="sd">        has been exhausted: return number of SELECT results.</span>
<span class="sd">        &lt;/br&gt;        If queryStr is left to None, the value of </span>
<span class="sd">        self.most_recent_query is used.</span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;queryStr&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;{None | string}&lt;/i&gt;&lt;/b&gt;): query that was used in a prior call to query()&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; number of records in SELECT result.&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; int&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError if no prior query is still active.&lt;/br&gt;        &#39;&#39;&#39;</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">queryStr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_recent_query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">most_recent_query</span><span class="p">]</span><span class="o">.</span><span class="n">rowcount</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No previous query available.&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="n">queryStr</span><span class="p">]</span><span class="o">.</span><span class="n">rowcount</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query &#39;</span><span class="si">%s</span><span class="s2">&#39; is no longer active.&quot;</span> <span class="o">%</span> <span class="n">queryStr</span><span class="p">)</span>

    
    <span class="c1">#-------------------------</span>
    <span class="c1"># execute </span>
    <span class="c1">#--------------</span>
            
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">query</span><span class="p">,</span> <span class="n">doCommit</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>                                                                                   
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Execute an arbitrary query, including</span>
<span class="sd">        MySQL directives. Return value is undefined.</span>
<span class="sd">        For SELECT queries or others that return</span>
<span class="sd">        results from MySQL, use the query() method. </span>
<span class="sd">        &lt;/br&gt;        Note: For some funky directives you get the MySQL error:</span>
<span class="sd">        &lt;/br&gt;            Commands out of sync; you can&#39;t run this command now </span>
<span class="sd">            &lt;/br&gt;        For those, turn doCommit to False;</span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;query&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): query or directive&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; (None,None) if all went well, else a tuple: (listOrErrors, listOfWarnings)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ([str],[str])}&lt;/br&gt;        &#39;&#39;&#39;</span>
        
        <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cursor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>                                                                        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>                                                                                                   
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                    <span class="c1"># Eat any query results and discard them:</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># The following show_warnings() will</span>
                    <span class="c1"># reveal the error:</span>
                    <span class="k">pass</span>
        <span class="k">finally</span><span class="p">:</span>                                                                                               
            <span class="k">if</span> <span class="n">doCommit</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># If the above MySQL call had an error,</span>
                <span class="c1"># it will generate an exception when </span>
                <span class="c1"># close the cursor. But that error info</span>
                <span class="c1"># will be caught in the show_warnings()</span>
                <span class="c1"># below; so ignore it here:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
            <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># executeParameterized</span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">executeParameterized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">query</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>                                                                      
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Executes arbitrary query that is parameterized</span>
<span class="sd">        as in the Python string format statement. Ex:</span>
<span class="sd">        executeParameterized(&#39;SELECT %s FROM myTable&#39;, (&#39;col1&#39;, &#39;col3&#39;))</span>
<span class="sd">        &lt;/br&gt;        Return value is undefined. For SELECT queries or others that return</span>
<span class="sd">        results from MySQL, use the query() method.        </span>
<span class="sd">&lt;/br&gt;        Note: params must be a tuple. Example: to update a column:: </span>
<span class="sd">        mysqldb.executeParameterized(&quot;UPDATE myTable SET col1=%s&quot;, (myVal,))</span>
<span class="sd">        the comma after &#39;myVal&#39; is mandatory; it indicates that the </span>
<span class="sd">        expression is a tuple.</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;query&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): query with parameter placeholder&lt;/br&gt;        &lt;b&gt;params&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;(&lt;any&gt;)&lt;/i&gt;&lt;/b&gt;): tuple of actuals for the parameters.&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; (None,None) if all ok, else tuple: (errorList, warningsList)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ([str],[str])}&lt;/br&gt;        &#39;&#39;&#39;</span>

        <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cursor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>                                                                        
        <span class="k">try</span><span class="p">:</span>                                                                                                   
            <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># The following show_warnings() will</span>
                    <span class="c1"># reveal the error:</span>
                    <span class="k">pass</span>
            <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
                <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>                                                                                                                                                                          
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>

    <span class="c1"># ----------------------- Utilities -------------------------                    </span>


    <span class="c1">#-------------------------</span>
    <span class="c1"># query_exhausted </span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">query_exhausted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>

        <span class="c1"># Delete the cursor&#39;s entry in the </span>
        <span class="c1"># cursors { queryStr --&gt; cursor } dict.</span>
        <span class="c1"># Since there will be few entries, the</span>
        <span class="c1"># following dictionary scan isn&#39;t a problem:</span>
    
        <span class="n">cursors_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">the_cursor</span> <span class="ow">in</span> <span class="n">cursors_copy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">the_cursor</span> <span class="o">==</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="n">query_str</span><span class="p">]</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="c1">#-------------------------</span>
    <span class="c1"># _ensureSQLTyping</span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">_ensureSQLTyping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colVals</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Given a list of items, return a string that preserves</span>
<span class="sd">        MySQL typing. Example: (10, &#39;My Poem&#39;) ---&gt; &#39;10, &quot;My Poem&quot;&#39;</span>
<span class="sd">        Note that &#39;,&#39;.join(map(str,myList)) won&#39;t work:</span>
<span class="sd">        (10, &#39;My Poem&#39;) ---&gt; &#39;10, My Poem&#39;</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;colVals&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;&lt;any&gt;&lt;/i&gt;&lt;/b&gt;): list of column values destined for a MySQL table&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; string of string-separated, properly typed column values&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; string&lt;/br&gt;        &#39;&#39;&#39;</span>

        <span class="n">resList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">colVals</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># If value is not already UTF-8, encode it:</span>
                    <span class="n">cleanStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="c1"># Value was already in Unicode, so all is well:</span>
                    <span class="n">cleanStr</span> <span class="o">=</span> <span class="n">el</span>
                <span class="n">resList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">cleanStr</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">el</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">resList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;null&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">set</span><span class="p">)):</span>
                <span class="n">resList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># e.g. numbers</span>
                <span class="n">resList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">resList</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">UnicodeEncodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Unicode related error: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            
    <span class="c1">#-------------------------</span>
    <span class="c1"># convert_to_string</span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">convert_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strLike</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The str/byte/unicode type mess between</span>
<span class="sd">        Python 2.7 and 3.x. We want as &#39;normal&#39;</span>
<span class="sd">        a string as possible. Surely there is a</span>
<span class="sd">        more elegant way.</span>
<span class="sd">        &lt;/br&gt;        @param strLike: a Python 3 str (i.e. unicode string), a Python 3 binary str.</span>
<span class="sd">            a Python 2.7 unicode string, or a Python 2.7 str.</span>
<span class="sd">        @type strLike: {str|unicode|byte}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">strLike</span><span class="p">)</span> <span class="o">==</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;unicode&#39;</span><span class="p">):</span>
                <span class="c1"># Python 2.7 unicode --&gt; str:</span>
                <span class="n">strLike</span> <span class="o">=</span> <span class="n">strLike</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">strLike</span><span class="p">)</span> <span class="o">==</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;bytes&#39;</span><span class="p">):</span>
                <span class="c1"># Python 3 byte string:</span>
                <span class="n">strLike</span> <span class="o">=</span> <span class="n">strLike</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">return</span> <span class="n">strLike</span>

    
    <span class="c1">#-------------------------</span>
    <span class="c1"># _stringifyList</span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">_stringifyList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Goes through the iterable. For each element, tries</span>
<span class="sd">        to turn into a string, part of which attempts encoding</span>
<span class="sd">        with the &#39;ascii&#39; codec. Then encountering a unicode</span>
<span class="sd">        char, that char is UTF-8 encoded. The special value</span>
<span class="sd">        None is *not* turned into a string. It will be turned</span>
<span class="sd">        into a NULL instead.</span>
<span class="sd">        &lt;/br&gt;        Acts as an iterator! Use like:</span>
<span class="sd">        for element in _stringifyList(someList):</span>
<span class="sd">            print(element)</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;iterable&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;[&lt;any&gt;]&lt;/i&gt;&lt;/b&gt;): mixture of items of any type, including Unicode strings.&lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">yield</span><span class="p">(</span><span class="s1">&#39;NULL&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">element</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    
    <span class="c1">#-------------------------</span>
    <span class="c1"># find_mysql_path </span>
    <span class="c1">#--------------</span>
    
    <span class="nd">@classmethod</span>            
    <span class="k">def</span> <span class="nf">find_mysql_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Finds the location of the mysql client program</span>
<span class="sd">        on the current machine. Needed for testing. So</span>
<span class="sd">        we make sure the method works when running outside</span>
<span class="sd">        of Eclipse as well as in.</span>
<span class="sd">        &lt;/br&gt;        Stores path in MySQLDB.mysql_loc.</span>
<span class="sd">        &lt;/br&gt;        @param cls: class instance of MySQLDB</span>
<span class="sd">        @type cls: MySQLDB</span>
<span class="sd">        @return: path to mysql client application</span>
<span class="sd">        @rtype: str</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="c1"># The &#39;command -v mysql...&#39; idiom always returns an empty</span>
        <span class="c1"># string when probed from Eclipse. To facilitate debugging</span>
        <span class="c1"># we find an alternative method for running in Eclipse.  </span>
        
        <span class="n">mysql_loc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Eclipse puts extra info into the env:</span>
        <span class="n">eclipse_indicator</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;XPC_SERVICE_NAME&#39;</span><span class="p">)</span>
        
        <span class="c1"># If the indicator is absent, or it doesn&#39;t include</span>
        <span class="c1"># the eclipse info, then we are not in Eclipse; the usual</span>
        <span class="c1"># case, of course:</span>
        
        <span class="k">if</span> <span class="n">eclipse_indicator</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
           <span class="n">eclipse_indicator</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span> <span class="ow">or</span> \
           <span class="n">eclipse_indicator</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;org.eclipse.platform.ide&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Not running in Eclipse; use reliable method to find mysql:</span>
            <span class="n">mysql_loc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                                        <span class="s2">&quot;command -v mysql; exit 0&quot;</span><span class="p">,</span>
                                        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>
                                        <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                        <span class="n">env</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_loc</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;MySQL client not found on this machine (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># We are in Eclipse:</span>
            <span class="n">possible_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/usr/local/bin/mysql&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;/usr/local/mysql/bin/mysql&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;/usr/bin/mysql&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;/bin/mysql&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">possible_paths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">mysql_loc</span> <span class="o">=</span> <span class="n">path</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">mysql_loc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;MySQL client not found on this machine (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>
        
        <span class="n">MySQLDB</span><span class="o">.</span><span class="n">mysql_loc</span> <span class="o">=</span> <span class="n">mysql_loc</span>
        <span class="k">return</span> <span class="n">mysql_loc</span>
        

<span class="c1"># ----------------------- Class QueryResult -------------------------</span>

<span class="k">class</span> <span class="nc">QueryResult</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Iterator for query results. Given an instance</span>
<span class="sd">    of this class I, the following works as expected:</span>
<span class="sd">&lt;/br&gt;        for res in I:</span>
<span class="sd">            print(res)</span>
<span class="sd">            &lt;/br&gt;    Instances of this class are returned by MySQLDB&#39;s </span>
<span class="sd">    query() method. Use next() and nextall() to get</span>
<span class="sd">    one result at a time, or all at once.</span>
<span class="sd">    &#39;&#39;&#39;</span>
  
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">cursor_owner_obj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span> <span class="o">=</span> <span class="n">cursor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_owner</span> <span class="o">=</span> <span class="n">cursor_owner_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">the_query_str</span>    <span class="o">=</span> <span class="n">query_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exhausted</span>    <span class="o">=</span> <span class="bp">False</span>
      
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the next result in a query, </span>
<span class="sd">        or raise StopIteration if no results</span>
<span class="sd">        remain.</span>
<span class="sd">        &lt;/br&gt;        Note: Returns the zeroeth element</span>
<span class="sd">        of the result. So:</span>
<span class="sd">        `(&#39;foo&#39;,)  --&gt; &#39;foo&#39;` </span>
<span class="sd">        and </span>
<span class="sd">        `({&#39;col1&#39; : 10},) ==&gt; {&#39;col1&#39; : 10}`</span>
<span class="sd">&lt;/br&gt;        This convention is in contrast to what</span>
<span class="sd">        cursor.fetconeh() does.</span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; StopIteration&lt;/br&gt;        &#39;&#39;&#39;</span>
  
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_owner</span><span class="o">.</span><span class="n">query_exhausted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exhausted</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">()</span>            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span>
         
    <span class="n">__next__</span> <span class="o">=</span> <span class="nb">next</span>
    
    <span class="k">def</span> <span class="nf">nextall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the remaining query results as a </span>
<span class="sd">        tuple of tuples.</span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; all remaining tuples inside a wrapper tuple, or empty tuple if no results remain.&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; ((str))&lt;/br&gt;        &lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="n">all_remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># We exhausted the query, so clean up:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_owner</span><span class="o">.</span><span class="n">query_exhausted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exhausted</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="n">all_remaining</span>

    <span class="k">def</span> <span class="nf">query_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Provide query that led to this result.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">the_query_str</span>

    <span class="k">def</span> <span class="nf">result_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the number of results in this result object.</span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; number of query results&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; int&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError if query no longer active.&lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exhausted</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query &#39;</span><span class="si">%s</span><span class="s2">&#39; is no longer active.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_str</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="o">.</span><span class="n">rowcount</span>
      
      
<span class="c1"># ----------------------- Context Managers -------------------------    </span>

<span class="c1"># Ability to write:</span>
<span class="c1">#    with no_warn_no_table():</span>
<span class="c1">#       ... DROP TABLE IF NOT EXISTS ...</span>
<span class="c1"># without annoying Python-level warnings that the</span>
<span class="c1"># table did not exist:</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">no_warn_no_table</span><span class="p">():</span>
    <span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Unknown table&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">db_warning</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">resetwarnings</span><span class="p">()</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">no_warn_dup_key</span><span class="p">():</span>
    <span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Duplicate entry&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">db_warning</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">resetwarnings</span><span class="p">()</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">no_db_warnings</span><span class="p">():</span>
    <span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">db_warning</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">resetwarnings</span><span class="p">()</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.no_db_warnings">
    <p>def <span class="ident">no_db_warnings</span>(</p><p>*args, **kwds)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.no_db_warnings', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.no_db_warnings" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">no_db_warnings</span><span class="p">():</span>
    <span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">db_warning</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">resetwarnings</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.no_warn_dup_key">
    <p>def <span class="ident">no_warn_dup_key</span>(</p><p>*args, **kwds)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.no_warn_dup_key', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.no_warn_dup_key" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">no_warn_dup_key</span><span class="p">():</span>
    <span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Duplicate entry&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">db_warning</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">resetwarnings</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.no_warn_no_table">
    <p>def <span class="ident">no_warn_no_table</span>(</p><p>*args, **kwds)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.no_warn_no_table', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.no_warn_no_table" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">no_warn_no_table</span><span class="p">():</span>
    <span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Unknown table&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">db_warning</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">resetwarnings</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="pymysql_utilsTmp.Cursors" class="name">class <span class="ident">Cursors</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.Cursors', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.Cursors" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Cursors</span><span class="p">:</span>
    <span class="n">BASIC</span>           <span class="o">=</span> <span class="bp">None</span>
    <span class="n">DICT</span>            <span class="o">=</span> <span class="n">DictCursor</span>
    <span class="n">SS_CURSOR</span>       <span class="o">=</span> <span class="n">SSCursor</span>
    <span class="n">SS_DICT_CURSOR</span>  <span class="o">=</span> <span class="n">SSDictCursor</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pymysql_utilsTmp.Cursors">Cursors</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="pymysql_utilsTmp.Cursors.BASIC" class="name">var <span class="ident">BASIC</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.Cursors.DICT" class="name">var <span class="ident">DICT</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.Cursors.SS_CURSOR" class="name">var <span class="ident">SS_CURSOR</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.Cursors.SS_DICT_CURSOR" class="name">var <span class="ident">SS_DICT_CURSOR</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="pymysql_utilsTmp.DupKeyAction" class="name">class <span class="ident">DupKeyAction</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.DupKeyAction', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.DupKeyAction" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">DupKeyAction</span><span class="p">:</span>
    <span class="n">PREVENT</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">IGNORE</span>  <span class="o">=</span> <span class="mi">1</span>
    <span class="n">REPLACE</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pymysql_utilsTmp.DupKeyAction">DupKeyAction</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="pymysql_utilsTmp.DupKeyAction.IGNORE" class="name">var <span class="ident">IGNORE</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.DupKeyAction.PREVENT" class="name">var <span class="ident">PREVENT</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.DupKeyAction.REPLACE" class="name">var <span class="ident">REPLACE</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="pymysql_utilsTmp.MySQLDB" class="name">class <span class="ident">MySQLDB</span></p>
      
  
    <div class="desc"><p>Shallow interface to MySQL databases. Some niceties nonetheless.
- The query() method is an iterator. So::
      for result in db.query('SELECT * FROM foo'):
         print result
- Table manipulations (create/drop/...)
- Insertion/update</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MySQLDB</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Shallow interface to MySQL databases. Some niceties nonetheless.</span>
<span class="sd">      - The query() method is an iterator. So::</span>
<span class="sd">            for result in db.query(&#39;SELECT * FROM foo&#39;):</span>
<span class="sd">               print result</span>
<span class="sd">      - Table manipulations (create/drop/...)</span>
<span class="sd">      - Insertion/update</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">NON_ASCII_CHARS_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\x00-\x7F]+&#39;</span><span class="p">)</span>

    <span class="c1"># ----------------------- Top-Level Housekeeping -------------------------</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># Constructor</span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> 
                 <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span> 
                 <span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> 
                 <span class="n">passwd</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> 
                 <span class="n">db</span><span class="o">=</span><span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
                 <span class="n">cursor_class</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates connection to the underlying MySQL database.</span>
<span class="sd">        This connection is maintained until method close()</span>
<span class="sd">        is called. The optional cursor_class controls the</span>
<span class="sd">        format in which query results are returned. The </span>
<span class="sd">        Values must be one of Cursors.DICT, Cursors.SS_CURSOR,</span>
<span class="sd">        etc. See definition of class Cursors above. </span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;host&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): MySQL host&lt;/br&gt;        &lt;b&gt;port&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;int&lt;/i&gt;&lt;/b&gt;): MySQL host&#39;s port&lt;/br&gt;        &lt;b&gt;user&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): user to log in as&lt;/br&gt;        &lt;b&gt;passwd&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): password to use for given user&lt;/br&gt;        &lt;b&gt;db&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): database to connect to within server&lt;/br&gt;        &lt;b&gt;cursor_class&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;Cursors&lt;/i&gt;&lt;/b&gt;): choice of how rows are returned&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; RuntimeError if mysql client program not found.&lt;/br&gt;    &lt;/br&gt;        &#39;&#39;&#39;</span>
        
        <span class="c1"># If all arguments are set to None, we are unittesting:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">arg</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">passwd</span><span class="p">,</span><span class="n">db</span><span class="p">)):</span>
            <span class="k">return</span>
        
        <span class="c1"># However, cannot have any of the connection parms None.</span>
        <span class="c1"># Get a list of parameter names whose values are None:</span>
        <span class="n">potential_offenders</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">({</span><span class="s1">&#39;host&#39;</span> <span class="p">:</span> <span class="n">host</span><span class="p">,</span>
                                           <span class="s1">&#39;db&#39;</span> <span class="p">:</span> <span class="n">db</span><span class="p">,</span> 
                                           <span class="s1">&#39;user&#39;</span> <span class="p">:</span> <span class="n">user</span><span class="p">,</span> 
                                           <span class="s1">&#39;passwd&#39;</span> <span class="p">:</span> <span class="n">passwd</span><span class="p">,</span> 
                                           <span class="s1">&#39;port&#39;</span> <span class="p">:</span> <span class="n">port</span><span class="p">}</span>
                                          <span class="p">)</span>
        <span class="n">bad_parms</span> <span class="o">=</span> <span class="p">[</span><span class="n">none_parms</span> <span class="k">for</span> <span class="n">none_parms</span> <span class="ow">in</span> <span class="n">potential_offenders</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">potential_offenders</span><span class="p">[</span><span class="n">none_parms</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">]</span>
        <span class="c1"># If &#39;host&#39; and &#39;user&#39; are None, we now have: [&#39;host&#39;, &#39;user&#39;]</span>
        <span class="c1"># If none of the above parms is None, non_parms will be empty:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bad_parms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;None value(s) for </span><span class="si">%s</span><span class="s1">; none of host,port,user,passwd or db must be None&#39;</span> <span class="o">%</span> <span class="n">bad_parms</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cursor_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># Ensure we caller passed a valid cursor class:</span>
            <span class="k">if</span> <span class="n">cursor_class</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">DictCursor</span><span class="p">,</span> <span class="n">SSCursor</span><span class="p">,</span> <span class="n">SSDictCursor</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Non-existing cursor class &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">cursor_class</span><span class="p">))</span>
        
        <span class="c1"># Ensure proper data types: all but port must be strings:</span>
        <span class="k">del</span> <span class="n">potential_offenders</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span>
        
        <span class="n">type_offenders</span> <span class="o">=</span> <span class="p">[</span><span class="n">bad_type_parms</span> <span class="k">for</span> <span class="n">bad_type_parms</span> <span class="ow">in</span> <span class="n">potential_offenders</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 
                          <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">potential_offenders</span><span class="p">[</span><span class="n">bad_type_parms</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">]</span>
        
        <span class="c1"># OK for port to be an int:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_offenders</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Value(s) </span><span class="si">%s</span><span class="s1"> have bad type;host,user,passwd, and db must be strings; port must be int.&#39;</span> 
                             <span class="o">%</span> <span class="n">type_offenders</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Port must be an integer; was </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwd</span>  <span class="o">=</span> <span class="n">passwd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span>   <span class="o">=</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">db</span>
        <span class="c1"># Will hold querySt-&gt;cursor for two purposes:</span>
        <span class="c1"># Ability to retrieve number of results in SELECT,</span>
        <span class="c1"># Ensure that all cursors are closed (see query()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">most_recent_query</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="c1"># Find location of mysql client program.</span>
        <span class="c1"># Will raise error if not found.</span>
        <span class="n">MySQLDB</span><span class="o">.</span><span class="n">find_mysql_path</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cursor_class</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
                                                  <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> 
                                                  <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> 
                                                  <span class="n">passwd</span><span class="o">=</span><span class="n">passwd</span><span class="p">,</span> 
                                                  <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
                                                  <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
                                                  <span class="n">local_infile</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> 
                                                  <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> 
                                                  <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> 
                                                  <span class="n">passwd</span><span class="o">=</span><span class="n">passwd</span><span class="p">,</span> 
                                                  <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
                                                  <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
                                                  <span class="n">cursorclass</span><span class="o">=</span><span class="n">cursor_class</span><span class="p">,</span>
                                                  <span class="n">local_infile</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">except</span> <span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">pwd</span> <span class="o">=</span> <span class="s1">&#39;...............&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">passwd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&lt;no password&gt;&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot reach MySQL server with host:</span><span class="si">%s</span><span class="s1">, port:</span><span class="si">%s</span><span class="s1">, user:</span><span class="si">%s</span><span class="s1">, pwd:</span><span class="si">%s</span><span class="s1">, db:</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
        <span class="c1"># Unanticipated errors:</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">pwd</span> <span class="o">=</span> <span class="s1">&#39;...............&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">passwd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&lt;no password&gt;&#39;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Error when connecting to database with host:</span><span class="si">%s</span><span class="s1">, port:</span><span class="si">%s</span><span class="s1">, user:</span><span class="si">%s</span><span class="s1">, pwd:</span><span class="si">%s</span><span class="s1">, db:</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
      

    <span class="c1">#-------------------------</span>
    <span class="c1"># dbName </span>
    <span class="c1">#--------------</span>
        
    <span class="k">def</span> <span class="nf">dbName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return name of database to which this MySQLDB is connected.</span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; name of database within MySQL server to which MySQLDB instance is connected.&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; String&lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span>
    
    <span class="c1">#-------------------------</span>
    <span class="c1"># close </span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Close all cursors that are currently still open.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># isOpen</span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">isOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns True if the connection to the databases</span>
<span class="sd">        is open. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">open</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
      
    <span class="c1"># ----------------------- Table Management -------------------------</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># createTable</span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">createTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableName</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">temporary</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create new table, given its name, and schema.</span>
<span class="sd">        The schema is a dict mappingt column names to </span>
<span class="sd">        column types. Example: {&#39;col1&#39; : &#39;INT&#39;, &#39;col2&#39; : &#39;TEXT&#39;}</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;tableName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of new table&lt;/br&gt;        &lt;b&gt;schema&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;Dict&lt;String,String&gt;&lt;/i&gt;&lt;/b&gt;): dictionary mapping column names to column types&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError: if table to truncate does not exist or permissions issues.&lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="n">colSpec</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">colName</span><span class="p">,</span> <span class="n">colVal</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">colSpec</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">colVal</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;CREATE </span><span class="si">%s</span><span class="s1"> TABLE IF NOT EXISTS </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">) &#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="s1">&#39;TEMPORARY&#39;</span> <span class="k">if</span> <span class="n">temporary</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="n">tableName</span><span class="p">,</span> 
            <span class="n">colSpec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># dropTable</span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">dropTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableName</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Delete table safely. No errors</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;tableName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of table&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError: if table to drop does not exist or permissions issues.&lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Suppress warning about table not existing:</span>
            <span class="k">with</span> <span class="n">no_warn_no_table</span><span class="p">():</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DROP TABLE IF EXISTS </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tableName</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In pymysql_utils dropTable(): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ProgrammingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In pymysql_utils dropTable(): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># truncateTable </span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">truncateTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableName</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Delete all table rows. No errors</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;tableName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of table&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError: if table to truncate does not exist or permissions issues.&lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;TRUNCATE TABLE </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tableName</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In pymysql_utils truncateTable(): </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">ProgrammingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In pymysql_utils truncateTable(): </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># ----------------------- Insertion and Updates -------------------------</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># insert </span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tblName</span><span class="p">,</span> <span class="n">colnameValueDict</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Given a dictionary mapping column names to column values,</span>
<span class="sd">        insert the data into a specified table</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;tblName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of table to insert into&lt;/br&gt;        &lt;b&gt;colnameValueDict&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;Dict&lt;String,Any&gt;&lt;/i&gt;&lt;/b&gt;): mapping of column name to column value&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; (None,None) if all ok, else tuple (errorList, warningsList)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ({ (str) | None},{ (str) | None})}&lt;/br&gt;        &#39;&#39;&#39;</span>

        <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">colNames</span><span class="p">,</span> <span class="n">colValues</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">colnameValueDict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wellTypedColValues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensureSQLTyping</span><span class="p">(</span><span class="n">colValues</span><span class="p">)</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;INSERT INTO </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">) VALUES (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tblName</span><span class="p">),</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">colNames</span><span class="p">),</span> <span class="n">wellTypedColValues</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># The following show_warnings() will</span>
                    <span class="c1"># reveal the error:</span>
                    <span class="k">pass</span>
            <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
                <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>                
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>            
    
    <span class="c1">#-------------------------</span>
    <span class="c1"># bulkInsert </span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">bulkInsert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tblName</span><span class="p">,</span> <span class="n">colNameTuple</span><span class="p">,</span> <span class="n">valueTupleArray</span><span class="p">,</span> <span class="n">onDupKey</span><span class="o">=</span><span class="n">DupKeyAction</span><span class="o">.</span><span class="n">PREVENT</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Inserts large number of rows into given table. The</span>
<span class="sd">        rows must be provided as an array of tuples. Caller&#39;s</span>
<span class="sd">        choice whether duplicate keys should cause a warning,</span>
<span class="sd">        omitting the incoming row, omit the incoming row without</span>
<span class="sd">        a warning, or replace the existing row.</span>
<span class="sd">        &lt;/br&gt;        Returns None if all went well, else a list of error</span>
<span class="sd">        tuples.</span>
<span class="sd">        &lt;/br&gt;        Strategy: </span>
<span class="sd">        &lt;/br&gt;        write the values to a temp file, then generate a </span>
<span class="sd">        ``LOAD LOCAL INFILE...`` MySQL command and execute it in MySQL. </span>
<span class="sd">        Returns `None` if no errors/warnings, else returns the tuple</span>
<span class="sd">        of tuples with the warnings.</span>
<span class="sd">                &lt;/br&gt;        &lt;b&gt;tblName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): table into which to insert&lt;/br&gt;        &lt;b&gt;colNameTuple&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;(str[,str[...]])&lt;/i&gt;&lt;/b&gt;): tuple containing column names in proper order, i.e. corresponding to valueTupleArray orders.&lt;/br&gt;        &lt;b&gt;valueTupleArray&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;`[(&lt;MySQLVal&gt; [,&lt;MySQLval&gt;,...]])`&lt;/i&gt;&lt;/b&gt;): array of n-tuples, which hold the values. Order of values must correspond to order of column names in colNameTuple.&lt;/br&gt;        &lt;b&gt;onDupKey&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;DupKeyAction&lt;/i&gt;&lt;/b&gt;): determines action when incoming row would duplicate an existing row&#39;s unique key. If set to DupKeyAction.IGNORE, then the incoming tuple is skipped. If set to DupKeyAction.REPLACE, then the incoming tuple replaces the existing tuple. By default, each attempt to insert a duplicate key generates a warning.&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt;                             &lt;/br&gt;(None,None) is no errors or warnings occurred, else a tuple with (errorList, warningsList). Elements of warningsList reflect MySQL&#39;s output of &quot;show warnings;&quot; Example:: ((u&#39;Warning&#39;, 1062L, u&quot;Duplicate entry &#39;10&#39; for key &#39;PRIMARY&#39;&quot;),)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ({ (str) | None},{ (str) | None})}&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError if bad parameter.&lt;/br&gt;        &lt;/br&gt;        &#39;&#39;&#39;</span>

        <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">tmpCSVFile</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;bulkInsert&#39;</span><span class="p">,</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="c1"># Allow MySQL to read this tmp file:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">tmpCSVFile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="n">o644</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csvWriter</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">tmpCSVFile</span><span class="p">,</span> 
                                    <span class="n">dialect</span><span class="o">=</span><span class="s1">&#39;excel-tab&#39;</span><span class="p">,</span> 
                                    <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> 
                                    <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> 
                                    <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> 
                                    <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_MINIMAL</span><span class="p">)</span>
        <span class="c1"># Can&#39;t use csvWriter.writerows() b/c some rows have </span>
        <span class="c1"># weird chars: self.csvWriter.writerows(valueTupleArray)        </span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">valueTupleArray</span><span class="p">:</span>
            <span class="c1"># Convert each element in row to a string,</span>
            <span class="c1"># including mixed-in Unicode Strings:</span>
            <span class="n">clean_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">rowElement</span> <span class="k">for</span> <span class="n">rowElement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stringifyList</span><span class="p">(</span><span class="n">row</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">csvWriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">clean_row</span><span class="p">)</span>
        <span class="n">tmpCSVFile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        
        <span class="c1"># Create the MySQL column name list needed in the LOAD INFILE below.</span>
        <span class="c1"># We need &#39;(colName1,colName2,...)&#39;:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colNameTuple</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">colSpec</span> <span class="o">=</span> <span class="s1">&#39;()&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colSpec</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">colNameTuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">colName</span> <span class="ow">in</span> <span class="n">colNameTuple</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">colSpec</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">colName</span>
            <span class="n">colSpec</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

        <span class="c1"># For warnings from MySQL:</span>
        <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">onDupKey</span> <span class="o">==</span> <span class="n">DupKeyAction</span><span class="o">.</span><span class="n">PREVENT</span><span class="p">:</span>
                <span class="n">dupAction</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># trigger the MySQL default</span>
            <span class="k">elif</span> <span class="n">onDupKey</span> <span class="o">==</span> <span class="n">DupKeyAction</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">:</span>
                <span class="n">dupAction</span> <span class="o">=</span> <span class="s1">&#39;IGNORE&#39;</span>
            <span class="k">elif</span> <span class="n">onDupKey</span> <span class="o">==</span> <span class="n">DupKeyAction</span><span class="o">.</span><span class="n">REPLACE</span><span class="p">:</span>
                <span class="n">dupAction</span> <span class="o">=</span> <span class="s1">&#39;REPLACE&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Parameter onDupKey to bulkInsert method must be of type DupKeyAction; is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">onDupKey</span><span class="p">))</span>
            
            <span class="c1"># Remove quotes from the values inside the colNameTuple&#39;s:</span>
            <span class="n">mySQLCmd</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;LOAD DATA LOCAL INFILE &#39;</span><span class="si">%s</span><span class="s2">&#39; </span><span class="si">%s</span><span class="s2"> INTO TABLE </span><span class="si">%s</span><span class="s2"> FIELDS TERMINATED BY &#39;,&#39; &quot;</span> <span class="o">+</span>\
                        <span class="s2">&quot;OPTIONALLY ENCLOSED BY &#39;</span><span class="se">\&quot;</span><span class="s2">&#39; ESCAPED BY &#39;</span><span class="se">\\\\</span><span class="s2">&#39; LINES TERMINATED BY &#39;</span><span class="se">\\</span><span class="s2">n&#39; </span><span class="si">%s</span><span class="s2">&quot;</span>
                        <span class="p">)</span> <span class="o">%</span>  <span class="p">(</span><span class="n">tmpCSVFile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dupAction</span><span class="p">,</span> <span class="n">tblName</span><span class="p">,</span> <span class="n">colSpec</span><span class="p">)</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">mySQLCmd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># The following show_warnings() will</span>
                    <span class="c1"># reveal the error:</span>
                    <span class="k">pass</span>
            <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
                <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tmpCSVFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;commit;&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>            
    
    <span class="c1">#-------------------------</span>
    <span class="c1"># update </span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tblName</span><span class="p">,</span> <span class="n">colName</span><span class="p">,</span> <span class="n">newVal</span><span class="p">,</span> <span class="n">fromCondition</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update one column with a new value.</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;tblName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of table in which update is to occur&lt;/br&gt;        &lt;b&gt;colName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): column whose value is to be changed&lt;/br&gt;        &lt;b&gt;newVal&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;type acceptable to MySQL for the given column&lt;/i&gt;&lt;/b&gt;): value acceptable to MySQL for the given column&lt;/br&gt;        &lt;b&gt;fromCondition&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): optionally condition that selects which rows to update. if None, the named column in all rows are updated to the given value. Syntax must conform to what may be in a MySQL FROM clause (don&#39;t include the &#39;FROM&#39; keyword)&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; (None,None) if all ok, else tuple (errorList, warningsList)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ([str],[str])}&lt;/br&gt;        &#39;&#39;&#39;</span>

        <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fromCondition</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">newVal</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c1"># The double-% causes the &#39;%s&#39; to be retained</span>
                    <span class="c1"># in the update string. The underlying mysqldb</span>
                    <span class="c1"># package will substitute that later for None.</span>
                    <span class="c1"># I.e.: create a two-tuple:</span>
                    <span class="c1">#</span>
                    <span class="c1">#   (&#39;UPDATE unittest SET col1 = %s&#39;, (None,))</span>
                    <span class="c1">#</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;UPDATE </span><span class="si">%s</span><span class="s2"> SET </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%%</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tblName</span><span class="p">,</span><span class="n">colName</span><span class="p">),</span> <span class="p">(</span><span class="bp">None</span><span class="p">,))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;UPDATE </span><span class="si">%s</span><span class="s2"> SET </span><span class="si">%s</span><span class="s2"> = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tblName</span><span class="p">,</span><span class="n">colName</span><span class="p">,</span><span class="n">newVal</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">newVal</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c1"># See above for explanation of double-%:</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;UPDATE </span><span class="si">%s</span><span class="s2"> SET </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%%</span><span class="s2">s WHERE </span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tblName</span><span class="p">,</span><span class="n">colName</span><span class="p">,</span><span class="n">fromCondition</span><span class="p">),</span> <span class="p">(</span><span class="bp">None</span><span class="p">,))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;UPDATE </span><span class="si">%s</span><span class="s2"> SET </span><span class="si">%s</span><span class="s2"> = &#39;</span><span class="si">%s</span><span class="s2">&#39; WHERE </span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tblName</span><span class="p">,</span><span class="n">colName</span><span class="p">,</span><span class="n">newVal</span><span class="p">,</span><span class="n">fromCondition</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># If setting to None, cmd will be a tuple</span>
                    <span class="c1"># with the %s-notation UPDATE string first,</span>
                    <span class="c1"># and the values second:</span>
                    <span class="k">if</span> <span class="n">newVal</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># The following show_warnings() will</span>
                    <span class="c1"># reveal the error:</span>
                    <span class="k">pass</span>
            <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
                <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>            
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>            

    <span class="c1"># ----------------------- Queries -------------------------</span>
        
    <span class="c1">#-------------------------</span>
    <span class="c1"># query </span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryStr</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Query iterator. Given a query, return one result for each</span>
<span class="sd">        subsequent call. When all results have been retrieved,</span>
<span class="sd">        the iterator returns None.</span>
<span class="sd">        &lt;/br&gt;        IMPORTANT: what is returned is an *iterator*. So you</span>
<span class="sd">        need to call next() to get the first result, even if</span>
<span class="sd">        there is only one.</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;queryStr&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): the query to submit to MySQL&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; iterator of query results&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; iterator of tuples&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError on MySQL errors.&lt;/br&gt;        &#39;&#39;&#39;</span>

        <span class="c1"># The str/byte/unicode type mess between</span>
        <span class="c1"># Python 2.7 and 3.x. We want as &#39;normal&#39;</span>
        <span class="c1"># a string as possible. Surely there is a</span>
        <span class="c1"># more elegant way:</span>
        
        <span class="n">queryStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_string</span><span class="p">(</span><span class="n">queryStr</span><span class="p">)</span>
       
        <span class="c1"># For if caller never exhausts the results by repeated calls,</span>
        <span class="c1"># and to find cursor by query to get (e.g.) num results:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        
        <span class="c1"># Ability to find an active cursor by query </span>
        <span class="c1"># via result_count(queryString)...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="n">queryStr</span><span class="p">]</span> <span class="o">=</span> <span class="n">cursor</span>
        
        <span class="c1">#... or find it via  result_count()...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">most_recent_query</span> <span class="o">=</span> <span class="n">queryStr</span>

        <span class="k">try</span><span class="p">:</span>        
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">queryStr</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ProgrammingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">QueryResult</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">queryStr</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        
    <span class="c1">#-------------------------</span>
    <span class="c1"># result_count </span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">result_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryStr</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Given a query string, after that string served</span>
<span class="sd">        as query in a call to query(), and before the result iterator</span>
<span class="sd">        has been exhausted: return number of SELECT results.</span>
<span class="sd">        &lt;/br&gt;        If queryStr is left to None, the value of </span>
<span class="sd">        self.most_recent_query is used.</span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;queryStr&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;{None | string}&lt;/i&gt;&lt;/b&gt;): query that was used in a prior call to query()&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; number of records in SELECT result.&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; int&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError if no prior query is still active.&lt;/br&gt;        &#39;&#39;&#39;</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">queryStr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_recent_query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">most_recent_query</span><span class="p">]</span><span class="o">.</span><span class="n">rowcount</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No previous query available.&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="n">queryStr</span><span class="p">]</span><span class="o">.</span><span class="n">rowcount</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query &#39;</span><span class="si">%s</span><span class="s2">&#39; is no longer active.&quot;</span> <span class="o">%</span> <span class="n">queryStr</span><span class="p">)</span>

    
    <span class="c1">#-------------------------</span>
    <span class="c1"># execute </span>
    <span class="c1">#--------------</span>
            
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">query</span><span class="p">,</span> <span class="n">doCommit</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>                                                                                   
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Execute an arbitrary query, including</span>
<span class="sd">        MySQL directives. Return value is undefined.</span>
<span class="sd">        For SELECT queries or others that return</span>
<span class="sd">        results from MySQL, use the query() method. </span>
<span class="sd">        &lt;/br&gt;        Note: For some funky directives you get the MySQL error:</span>
<span class="sd">        &lt;/br&gt;            Commands out of sync; you can&#39;t run this command now </span>
<span class="sd">            &lt;/br&gt;        For those, turn doCommit to False;</span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;query&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): query or directive&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; (None,None) if all went well, else a tuple: (listOrErrors, listOfWarnings)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ([str],[str])}&lt;/br&gt;        &#39;&#39;&#39;</span>
        
        <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cursor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>                                                                        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>                                                                                                   
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                    <span class="c1"># Eat any query results and discard them:</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># The following show_warnings() will</span>
                    <span class="c1"># reveal the error:</span>
                    <span class="k">pass</span>
        <span class="k">finally</span><span class="p">:</span>                                                                                               
            <span class="k">if</span> <span class="n">doCommit</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># If the above MySQL call had an error,</span>
                <span class="c1"># it will generate an exception when </span>
                <span class="c1"># close the cursor. But that error info</span>
                <span class="c1"># will be caught in the show_warnings()</span>
                <span class="c1"># below; so ignore it here:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
            <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>

    <span class="c1">#-------------------------</span>
    <span class="c1"># executeParameterized</span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">executeParameterized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">query</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>                                                                      
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Executes arbitrary query that is parameterized</span>
<span class="sd">        as in the Python string format statement. Ex:</span>
<span class="sd">        executeParameterized(&#39;SELECT %s FROM myTable&#39;, (&#39;col1&#39;, &#39;col3&#39;))</span>
<span class="sd">        &lt;/br&gt;        Return value is undefined. For SELECT queries or others that return</span>
<span class="sd">        results from MySQL, use the query() method.        </span>
<span class="sd">&lt;/br&gt;        Note: params must be a tuple. Example: to update a column:: </span>
<span class="sd">        mysqldb.executeParameterized(&quot;UPDATE myTable SET col1=%s&quot;, (myVal,))</span>
<span class="sd">        the comma after &#39;myVal&#39; is mandatory; it indicates that the </span>
<span class="sd">        expression is a tuple.</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;query&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): query with parameter placeholder&lt;/br&gt;        &lt;b&gt;params&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;(&lt;any&gt;)&lt;/i&gt;&lt;/b&gt;): tuple of actuals for the parameters.&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; (None,None) if all ok, else tuple: (errorList, warningsList)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ([str],[str])}&lt;/br&gt;        &#39;&#39;&#39;</span>

        <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cursor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>                                                                        
        <span class="k">try</span><span class="p">:</span>                                                                                                   
            <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># The following show_warnings() will</span>
                    <span class="c1"># reveal the error:</span>
                    <span class="k">pass</span>
            <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
                <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>                                                                                                                                                                          
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>

    <span class="c1"># ----------------------- Utilities -------------------------                    </span>


    <span class="c1">#-------------------------</span>
    <span class="c1"># query_exhausted </span>
    <span class="c1">#--------------</span>

    <span class="k">def</span> <span class="nf">query_exhausted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>

        <span class="c1"># Delete the cursor&#39;s entry in the </span>
        <span class="c1"># cursors { queryStr --&gt; cursor } dict.</span>
        <span class="c1"># Since there will be few entries, the</span>
        <span class="c1"># following dictionary scan isn&#39;t a problem:</span>
    
        <span class="n">cursors_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">the_cursor</span> <span class="ow">in</span> <span class="n">cursors_copy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">the_cursor</span> <span class="o">==</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="n">query_str</span><span class="p">]</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="c1">#-------------------------</span>
    <span class="c1"># _ensureSQLTyping</span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">_ensureSQLTyping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colVals</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Given a list of items, return a string that preserves</span>
<span class="sd">        MySQL typing. Example: (10, &#39;My Poem&#39;) ---&gt; &#39;10, &quot;My Poem&quot;&#39;</span>
<span class="sd">        Note that &#39;,&#39;.join(map(str,myList)) won&#39;t work:</span>
<span class="sd">        (10, &#39;My Poem&#39;) ---&gt; &#39;10, My Poem&#39;</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;colVals&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;&lt;any&gt;&lt;/i&gt;&lt;/b&gt;): list of column values destined for a MySQL table&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; string of string-separated, properly typed column values&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; string&lt;/br&gt;        &#39;&#39;&#39;</span>

        <span class="n">resList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">colVals</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># If value is not already UTF-8, encode it:</span>
                    <span class="n">cleanStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="c1"># Value was already in Unicode, so all is well:</span>
                    <span class="n">cleanStr</span> <span class="o">=</span> <span class="n">el</span>
                <span class="n">resList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">cleanStr</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">el</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">resList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;null&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">set</span><span class="p">)):</span>
                <span class="n">resList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># e.g. numbers</span>
                <span class="n">resList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">resList</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">UnicodeEncodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Unicode related error: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            
    <span class="c1">#-------------------------</span>
    <span class="c1"># convert_to_string</span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">convert_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strLike</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The str/byte/unicode type mess between</span>
<span class="sd">        Python 2.7 and 3.x. We want as &#39;normal&#39;</span>
<span class="sd">        a string as possible. Surely there is a</span>
<span class="sd">        more elegant way.</span>
<span class="sd">        &lt;/br&gt;        @param strLike: a Python 3 str (i.e. unicode string), a Python 3 binary str.</span>
<span class="sd">            a Python 2.7 unicode string, or a Python 2.7 str.</span>
<span class="sd">        @type strLike: {str|unicode|byte}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">strLike</span><span class="p">)</span> <span class="o">==</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;unicode&#39;</span><span class="p">):</span>
                <span class="c1"># Python 2.7 unicode --&gt; str:</span>
                <span class="n">strLike</span> <span class="o">=</span> <span class="n">strLike</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">strLike</span><span class="p">)</span> <span class="o">==</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;bytes&#39;</span><span class="p">):</span>
                <span class="c1"># Python 3 byte string:</span>
                <span class="n">strLike</span> <span class="o">=</span> <span class="n">strLike</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">return</span> <span class="n">strLike</span>

    
    <span class="c1">#-------------------------</span>
    <span class="c1"># _stringifyList</span>
    <span class="c1">#--------------</span>
    
    <span class="k">def</span> <span class="nf">_stringifyList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Goes through the iterable. For each element, tries</span>
<span class="sd">        to turn into a string, part of which attempts encoding</span>
<span class="sd">        with the &#39;ascii&#39; codec. Then encountering a unicode</span>
<span class="sd">        char, that char is UTF-8 encoded. The special value</span>
<span class="sd">        None is *not* turned into a string. It will be turned</span>
<span class="sd">        into a NULL instead.</span>
<span class="sd">        &lt;/br&gt;        Acts as an iterator! Use like:</span>
<span class="sd">        for element in _stringifyList(someList):</span>
<span class="sd">            print(element)</span>
<span class="sd">&lt;/br&gt;        &lt;b&gt;iterable&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;[&lt;any&gt;]&lt;/i&gt;&lt;/b&gt;): mixture of items of any type, including Unicode strings.&lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">yield</span><span class="p">(</span><span class="s1">&#39;NULL&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">element</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    
    <span class="c1">#-------------------------</span>
    <span class="c1"># find_mysql_path </span>
    <span class="c1">#--------------</span>
    
    <span class="nd">@classmethod</span>            
    <span class="k">def</span> <span class="nf">find_mysql_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Finds the location of the mysql client program</span>
<span class="sd">        on the current machine. Needed for testing. So</span>
<span class="sd">        we make sure the method works when running outside</span>
<span class="sd">        of Eclipse as well as in.</span>
<span class="sd">        &lt;/br&gt;        Stores path in MySQLDB.mysql_loc.</span>
<span class="sd">        &lt;/br&gt;        @param cls: class instance of MySQLDB</span>
<span class="sd">        @type cls: MySQLDB</span>
<span class="sd">        @return: path to mysql client application</span>
<span class="sd">        @rtype: str</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="c1"># The &#39;command -v mysql...&#39; idiom always returns an empty</span>
        <span class="c1"># string when probed from Eclipse. To facilitate debugging</span>
        <span class="c1"># we find an alternative method for running in Eclipse.  </span>
        
        <span class="n">mysql_loc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Eclipse puts extra info into the env:</span>
        <span class="n">eclipse_indicator</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;XPC_SERVICE_NAME&#39;</span><span class="p">)</span>
        
        <span class="c1"># If the indicator is absent, or it doesn&#39;t include</span>
        <span class="c1"># the eclipse info, then we are not in Eclipse; the usual</span>
        <span class="c1"># case, of course:</span>
        
        <span class="k">if</span> <span class="n">eclipse_indicator</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
           <span class="n">eclipse_indicator</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span> <span class="ow">or</span> \
           <span class="n">eclipse_indicator</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;org.eclipse.platform.ide&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Not running in Eclipse; use reliable method to find mysql:</span>
            <span class="n">mysql_loc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                                        <span class="s2">&quot;command -v mysql; exit 0&quot;</span><span class="p">,</span>
                                        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>
                                        <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                        <span class="n">env</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_loc</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;MySQL client not found on this machine (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># We are in Eclipse:</span>
            <span class="n">possible_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/usr/local/bin/mysql&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;/usr/local/mysql/bin/mysql&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;/usr/bin/mysql&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;/bin/mysql&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">possible_paths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">mysql_loc</span> <span class="o">=</span> <span class="n">path</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">mysql_loc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;MySQL client not found on this machine (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>
        
        <span class="n">MySQLDB</span><span class="o">.</span><span class="n">mysql_loc</span> <span class="o">=</span> <span class="n">mysql_loc</span>
        <span class="k">return</span> <span class="n">mysql_loc</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pymysql_utilsTmp.MySQLDB">MySQLDB</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="pymysql_utilsTmp.MySQLDB.NON_ASCII_CHARS_PATTERN" class="name">var <span class="ident">NON_ASCII_CHARS_PATTERN</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, host=&#39;127.0.0.1&#39;, port=3306, user=&#39;root&#39;, passwd=&#39;&#39;, db=&#39;mysql&#39;, cursor_class=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates connection to the underlying MySQL database.
This connection is maintained until method close()
is called. The optional cursor_class controls the
format in which query results are returned. The 
Values must be one of Cursors.DICT, Cursors.SS_CURSOR,
etc. See definition of class Cursors above. 
</br>        <b>host</b> (<b></i>string</i></b>): MySQL host</br>        <b>port</b> (<b></i>int</i></b>): MySQL host's port</br>        <b>user</b> (<b></i>string</i></b>): user to log in as</br>        <b>passwd</b> (<b></i>string</i></b>): password to use for given user</br>        <b>db</b> (<b></i>string</i></b>): database to connect to within server</br>        <b>cursor_class</b> (<b></i>Cursors</i></b>): choice of how rows are returned</br>        <b>raises:</b> ValueError</br>        <b>raises:</b> RuntimeError if mysql client program not found.</br>    </br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
             <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> 
             <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span> 
             <span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> 
             <span class="n">passwd</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> 
             <span class="n">db</span><span class="o">=</span><span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
             <span class="n">cursor_class</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Creates connection to the underlying MySQL database.</span>
<span class="sd">    This connection is maintained until method close()</span>
<span class="sd">    is called. The optional cursor_class controls the</span>
<span class="sd">    format in which query results are returned. The </span>
<span class="sd">    Values must be one of Cursors.DICT, Cursors.SS_CURSOR,</span>
<span class="sd">    etc. See definition of class Cursors above. </span>
<span class="sd">    &lt;/br&gt;        &lt;b&gt;host&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): MySQL host&lt;/br&gt;        &lt;b&gt;port&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;int&lt;/i&gt;&lt;/b&gt;): MySQL host&#39;s port&lt;/br&gt;        &lt;b&gt;user&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): user to log in as&lt;/br&gt;        &lt;b&gt;passwd&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): password to use for given user&lt;/br&gt;        &lt;b&gt;db&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): database to connect to within server&lt;/br&gt;        &lt;b&gt;cursor_class&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;Cursors&lt;/i&gt;&lt;/b&gt;): choice of how rows are returned&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; RuntimeError if mysql client program not found.&lt;/br&gt;    &lt;/br&gt;        &#39;&#39;&#39;</span>
    
    <span class="c1"># If all arguments are set to None, we are unittesting:</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">arg</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">passwd</span><span class="p">,</span><span class="n">db</span><span class="p">)):</span>
        <span class="k">return</span>
    
    <span class="c1"># However, cannot have any of the connection parms None.</span>
    <span class="c1"># Get a list of parameter names whose values are None:</span>
    <span class="n">potential_offenders</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">({</span><span class="s1">&#39;host&#39;</span> <span class="p">:</span> <span class="n">host</span><span class="p">,</span>
                                       <span class="s1">&#39;db&#39;</span> <span class="p">:</span> <span class="n">db</span><span class="p">,</span> 
                                       <span class="s1">&#39;user&#39;</span> <span class="p">:</span> <span class="n">user</span><span class="p">,</span> 
                                       <span class="s1">&#39;passwd&#39;</span> <span class="p">:</span> <span class="n">passwd</span><span class="p">,</span> 
                                       <span class="s1">&#39;port&#39;</span> <span class="p">:</span> <span class="n">port</span><span class="p">}</span>
                                      <span class="p">)</span>
    <span class="n">bad_parms</span> <span class="o">=</span> <span class="p">[</span><span class="n">none_parms</span> <span class="k">for</span> <span class="n">none_parms</span> <span class="ow">in</span> <span class="n">potential_offenders</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">potential_offenders</span><span class="p">[</span><span class="n">none_parms</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">]</span>
    <span class="c1"># If &#39;host&#39; and &#39;user&#39; are None, we now have: [&#39;host&#39;, &#39;user&#39;]</span>
    <span class="c1"># If none of the above parms is None, non_parms will be empty:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bad_parms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;None value(s) for </span><span class="si">%s</span><span class="s1">; none of host,port,user,passwd or db must be None&#39;</span> <span class="o">%</span> <span class="n">bad_parms</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">cursor_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Ensure we caller passed a valid cursor class:</span>
        <span class="k">if</span> <span class="n">cursor_class</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">DictCursor</span><span class="p">,</span> <span class="n">SSCursor</span><span class="p">,</span> <span class="n">SSDictCursor</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Non-existing cursor class &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">cursor_class</span><span class="p">))</span>
    
    <span class="c1"># Ensure proper data types: all but port must be strings:</span>
    <span class="k">del</span> <span class="n">potential_offenders</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span>
    
    <span class="n">type_offenders</span> <span class="o">=</span> <span class="p">[</span><span class="n">bad_type_parms</span> <span class="k">for</span> <span class="n">bad_type_parms</span> <span class="ow">in</span> <span class="n">potential_offenders</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 
                      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">potential_offenders</span><span class="p">[</span><span class="n">bad_type_parms</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">]</span>
    
    <span class="c1"># OK for port to be an int:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_offenders</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Value(s) </span><span class="si">%s</span><span class="s1"> have bad type;host,user,passwd, and db must be strings; port must be int.&#39;</span> 
                         <span class="o">%</span> <span class="n">type_offenders</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Port must be an integer; was </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
    
    
    <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pwd</span>  <span class="o">=</span> <span class="n">passwd</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">db</span>   <span class="o">=</span> <span class="n">db</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">db</span>
    <span class="c1"># Will hold querySt-&gt;cursor for two purposes:</span>
    <span class="c1"># Ability to retrieve number of results in SELECT,</span>
    <span class="c1"># Ensure that all cursors are closed (see query()):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">most_recent_query</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="c1"># Find location of mysql client program.</span>
    <span class="c1"># Will raise error if not found.</span>
    <span class="n">MySQLDB</span><span class="o">.</span><span class="n">find_mysql_path</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cursor_class</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
                                              <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> 
                                              <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> 
                                              <span class="n">passwd</span><span class="o">=</span><span class="n">passwd</span><span class="p">,</span> 
                                              <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
                                              <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
                                              <span class="n">local_infile</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> 
                                              <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> 
                                              <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> 
                                              <span class="n">passwd</span><span class="o">=</span><span class="n">passwd</span><span class="p">,</span> 
                                              <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
                                              <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
                                              <span class="n">cursorclass</span><span class="o">=</span><span class="n">cursor_class</span><span class="p">,</span>
                                              <span class="n">local_infile</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">except</span> <span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="s1">&#39;...............&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">passwd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&lt;no password&gt;&#39;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot reach MySQL server with host:</span><span class="si">%s</span><span class="s1">, port:</span><span class="si">%s</span><span class="s1">, user:</span><span class="si">%s</span><span class="s1">, pwd:</span><span class="si">%s</span><span class="s1">, db:</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
    <span class="c1"># Unanticipated errors:</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="s1">&#39;...............&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">passwd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&lt;no password&gt;&#39;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Error when connecting to database with host:</span><span class="si">%s</span><span class="s1">, port:</span><span class="si">%s</span><span class="s1">, user:</span><span class="si">%s</span><span class="s1">, pwd:</span><span class="si">%s</span><span class="s1">, db:</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.bulkInsert">
    <p>def <span class="ident">bulkInsert</span>(</p><p>self, tblName, colNameTuple, valueTupleArray, onDupKey=0)</p>
    </div>
    

    
  
    <div class="desc"><p>Inserts large number of rows into given table. The
rows must be provided as an array of tuples. Caller's
choice whether duplicate keys should cause a warning,
omitting the incoming row, omit the incoming row without
a warning, or replace the existing row.
</br>        Returns None if all went well, else a list of error
tuples.
</br>        Strategy: 
</br>        write the values to a temp file, then generate a 
<code>LOAD LOCAL INFILE...</code> MySQL command and execute it in MySQL. 
Returns <code>None</code> if no errors/warnings, else returns the tuple
of tuples with the warnings.
        </br>        <b>tblName</b> (<b></i>string</i></b>): table into which to insert</br>        <b>colNameTuple</b> (<b></i>(str[,str[...]])</i></b>): tuple containing column names in proper order, i.e. corresponding to valueTupleArray orders.</br>        <b>valueTupleArray</b> (<b></i><code>[(&lt;MySQLVal&gt; [,&lt;MySQLval&gt;,...]])</code></i></b>): array of n-tuples, which hold the values. Order of values must correspond to order of column names in colNameTuple.</br>        <b>onDupKey</b> (<b></i>DupKeyAction</i></b>): determines action when incoming row would duplicate an existing row's unique key. If set to DupKeyAction.IGNORE, then the incoming tuple is skipped. If set to DupKeyAction.REPLACE, then the incoming tuple replaces the existing tuple. By default, each attempt to insert a duplicate key generates a warning.</br>        <b>returns:</b>                             </br>(None,None) is no errors or warnings occurred, else a tuple with (errorList, warningsList). Elements of warningsList reflect MySQL's output of "show warnings;" Example:: ((u'Warning', 1062L, u"Duplicate entry '10' for key 'PRIMARY'"),)</br>        <b>return type:</b> {(None,None) | ({ (str) | None},{ (str) | None})}</br>        <b>raises:</b> ValueError if bad parameter.</br>        </br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.bulkInsert', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.bulkInsert" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">bulkInsert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tblName</span><span class="p">,</span> <span class="n">colNameTuple</span><span class="p">,</span> <span class="n">valueTupleArray</span><span class="p">,</span> <span class="n">onDupKey</span><span class="o">=</span><span class="n">DupKeyAction</span><span class="o">.</span><span class="n">PREVENT</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Inserts large number of rows into given table. The</span>
<span class="sd">    rows must be provided as an array of tuples. Caller&#39;s</span>
<span class="sd">    choice whether duplicate keys should cause a warning,</span>
<span class="sd">    omitting the incoming row, omit the incoming row without</span>
<span class="sd">    a warning, or replace the existing row.</span>
<span class="sd">    &lt;/br&gt;        Returns None if all went well, else a list of error</span>
<span class="sd">    tuples.</span>
<span class="sd">    &lt;/br&gt;        Strategy: </span>
<span class="sd">    &lt;/br&gt;        write the values to a temp file, then generate a </span>
<span class="sd">    ``LOAD LOCAL INFILE...`` MySQL command and execute it in MySQL. </span>
<span class="sd">    Returns `None` if no errors/warnings, else returns the tuple</span>
<span class="sd">    of tuples with the warnings.</span>
<span class="sd">            &lt;/br&gt;        &lt;b&gt;tblName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): table into which to insert&lt;/br&gt;        &lt;b&gt;colNameTuple&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;(str[,str[...]])&lt;/i&gt;&lt;/b&gt;): tuple containing column names in proper order, i.e. corresponding to valueTupleArray orders.&lt;/br&gt;        &lt;b&gt;valueTupleArray&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;`[(&lt;MySQLVal&gt; [,&lt;MySQLval&gt;,...]])`&lt;/i&gt;&lt;/b&gt;): array of n-tuples, which hold the values. Order of values must correspond to order of column names in colNameTuple.&lt;/br&gt;        &lt;b&gt;onDupKey&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;DupKeyAction&lt;/i&gt;&lt;/b&gt;): determines action when incoming row would duplicate an existing row&#39;s unique key. If set to DupKeyAction.IGNORE, then the incoming tuple is skipped. If set to DupKeyAction.REPLACE, then the incoming tuple replaces the existing tuple. By default, each attempt to insert a duplicate key generates a warning.&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt;                             &lt;/br&gt;(None,None) is no errors or warnings occurred, else a tuple with (errorList, warningsList). Elements of warningsList reflect MySQL&#39;s output of &quot;show warnings;&quot; Example:: ((u&#39;Warning&#39;, 1062L, u&quot;Duplicate entry &#39;10&#39; for key &#39;PRIMARY&#39;&quot;),)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ({ (str) | None},{ (str) | None})}&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError if bad parameter.&lt;/br&gt;        &lt;/br&gt;        &#39;&#39;&#39;</span>
    <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tmpCSVFile</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;bulkInsert&#39;</span><span class="p">,</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="c1"># Allow MySQL to read this tmp file:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">tmpCSVFile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="n">o644</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">csvWriter</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">tmpCSVFile</span><span class="p">,</span> 
                                <span class="n">dialect</span><span class="o">=</span><span class="s1">&#39;excel-tab&#39;</span><span class="p">,</span> 
                                <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> 
                                <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> 
                                <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> 
                                <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_MINIMAL</span><span class="p">)</span>
    <span class="c1"># Can&#39;t use csvWriter.writerows() b/c some rows have </span>
    <span class="c1"># weird chars: self.csvWriter.writerows(valueTupleArray)        </span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">valueTupleArray</span><span class="p">:</span>
        <span class="c1"># Convert each element in row to a string,</span>
        <span class="c1"># including mixed-in Unicode Strings:</span>
        <span class="n">clean_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">rowElement</span> <span class="k">for</span> <span class="n">rowElement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stringifyList</span><span class="p">(</span><span class="n">row</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csvWriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">clean_row</span><span class="p">)</span>
    <span class="n">tmpCSVFile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    
    <span class="c1"># Create the MySQL column name list needed in the LOAD INFILE below.</span>
    <span class="c1"># We need &#39;(colName1,colName2,...)&#39;:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colNameTuple</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">colSpec</span> <span class="o">=</span> <span class="s1">&#39;()&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">colSpec</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">colNameTuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">colName</span> <span class="ow">in</span> <span class="n">colNameTuple</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">colSpec</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">colName</span>
        <span class="n">colSpec</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>
    <span class="c1"># For warnings from MySQL:</span>
    <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">onDupKey</span> <span class="o">==</span> <span class="n">DupKeyAction</span><span class="o">.</span><span class="n">PREVENT</span><span class="p">:</span>
            <span class="n">dupAction</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># trigger the MySQL default</span>
        <span class="k">elif</span> <span class="n">onDupKey</span> <span class="o">==</span> <span class="n">DupKeyAction</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">:</span>
            <span class="n">dupAction</span> <span class="o">=</span> <span class="s1">&#39;IGNORE&#39;</span>
        <span class="k">elif</span> <span class="n">onDupKey</span> <span class="o">==</span> <span class="n">DupKeyAction</span><span class="o">.</span><span class="n">REPLACE</span><span class="p">:</span>
            <span class="n">dupAction</span> <span class="o">=</span> <span class="s1">&#39;REPLACE&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Parameter onDupKey to bulkInsert method must be of type DupKeyAction; is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">onDupKey</span><span class="p">))</span>
        
        <span class="c1"># Remove quotes from the values inside the colNameTuple&#39;s:</span>
        <span class="n">mySQLCmd</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;LOAD DATA LOCAL INFILE &#39;</span><span class="si">%s</span><span class="s2">&#39; </span><span class="si">%s</span><span class="s2"> INTO TABLE </span><span class="si">%s</span><span class="s2"> FIELDS TERMINATED BY &#39;,&#39; &quot;</span> <span class="o">+</span>\
                    <span class="s2">&quot;OPTIONALLY ENCLOSED BY &#39;</span><span class="se">\&quot;</span><span class="s2">&#39; ESCAPED BY &#39;</span><span class="se">\\\\</span><span class="s2">&#39; LINES TERMINATED BY &#39;</span><span class="se">\\</span><span class="s2">n&#39; </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="o">%</span>  <span class="p">(</span><span class="n">tmpCSVFile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dupAction</span><span class="p">,</span> <span class="n">tblName</span><span class="p">,</span> <span class="n">colSpec</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">mySQLCmd</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># The following show_warnings() will</span>
                <span class="c1"># reveal the error:</span>
                <span class="k">pass</span>
        <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
            <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">tmpCSVFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;commit;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>            
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.close">
    <p>def <span class="ident">close</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Close all cursors that are currently still open.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.close', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.close" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Close all cursors that are currently still open.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.convert_to_string">
    <p>def <span class="ident">convert_to_string</span>(</p><p>self, strLike)</p>
    </div>
    

    
  
    <div class="desc"><p>The str/byte/unicode type mess between
Python 2.7 and 3.x. We want as 'normal'
a string as possible. Surely there is a
more elegant way.
</br>        @param strLike: a Python 3 str (i.e. unicode string), a Python 3 binary str.
    a Python 2.7 unicode string, or a Python 2.7 str.
@type strLike: {str|unicode|byte}</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.convert_to_string', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.convert_to_string" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">convert_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strLike</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The str/byte/unicode type mess between</span>
<span class="sd">    Python 2.7 and 3.x. We want as &#39;normal&#39;</span>
<span class="sd">    a string as possible. Surely there is a</span>
<span class="sd">    more elegant way.</span>
<span class="sd">    &lt;/br&gt;        @param strLike: a Python 3 str (i.e. unicode string), a Python 3 binary str.</span>
<span class="sd">        a Python 2.7 unicode string, or a Python 2.7 str.</span>
<span class="sd">    @type strLike: {str|unicode|byte}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">strLike</span><span class="p">)</span> <span class="o">==</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;unicode&#39;</span><span class="p">):</span>
            <span class="c1"># Python 2.7 unicode --&gt; str:</span>
            <span class="n">strLike</span> <span class="o">=</span> <span class="n">strLike</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">strLike</span><span class="p">)</span> <span class="o">==</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;bytes&#39;</span><span class="p">):</span>
            <span class="c1"># Python 3 byte string:</span>
            <span class="n">strLike</span> <span class="o">=</span> <span class="n">strLike</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">return</span> <span class="n">strLike</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.createTable">
    <p>def <span class="ident">createTable</span>(</p><p>self, tableName, schema, temporary=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Create new table, given its name, and schema.
        The schema is a dict mappingt column names to 
        column types. Example: {'col1' : 'INT', 'col2' : 'TEXT'}
</br>        <b>tableName</b> (<b></i>String</i></b>): name of new table</br>        <b>schema</b> (<b></i>Dict<String,String></i></b>): dictionary mapping column names to column types</br>        <b>raises:</b> ValueError: if table to truncate does not exist or permissions issues.</br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.createTable', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.createTable" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">createTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableName</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">temporary</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create new table, given its name, and schema.</span>
<span class="sd">    The schema is a dict mappingt column names to </span>
<span class="sd">    column types. Example: {&#39;col1&#39; : &#39;INT&#39;, &#39;col2&#39; : &#39;TEXT&#39;}</span>
<span class="sd">&gt;        &lt;b&gt;tableName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of new table&lt;/br&gt;        &lt;b&gt;schema&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;Dict&lt;String,String&gt;&lt;/i&gt;&lt;/b&gt;): dictionary mapping column names to column types&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError: if table to truncate does not exist or permissions issues.&lt;/br&gt;        &#39;&#39;&#39;</span>
    <span class="n">colSpec</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">colName</span><span class="p">,</span> <span class="n">colVal</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">colSpec</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">colVal</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;CREATE </span><span class="si">%s</span><span class="s1"> TABLE IF NOT EXISTS </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">) &#39;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="s1">&#39;TEMPORARY&#39;</span> <span class="k">if</span> <span class="n">temporary</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">tableName</span><span class="p">,</span> 
        <span class="n">colSpec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.dbName">
    <p>def <span class="ident">dbName</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Return name of database to which this MySQLDB is connected.
</br>        <b>returns:</b> name of database within MySQL server to which MySQLDB instance is connected.</br>        <b>return type:</b> String</br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.dbName', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.dbName" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dbName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return name of database to which this MySQLDB is connected.</span>
<span class="sd">    &lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; name of database within MySQL server to which MySQLDB instance is connected.&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; String&lt;/br&gt;        &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.dropTable">
    <p>def <span class="ident">dropTable</span>(</p><p>self, tableName)</p>
    </div>
    

    
  
    <div class="desc"><p>Delete table safely. No errors
</br>        <b>tableName</b> (<b></i>String</i></b>): name of table</br>        <b>raises:</b> ValueError: if table to drop does not exist or permissions issues.</br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.dropTable', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.dropTable" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dropTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableName</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Delete table safely. No errors</span>
<span class="sd">&gt;        &lt;b&gt;tableName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of table&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError: if table to drop does not exist or permissions issues.&lt;/br&gt;        &#39;&#39;&#39;</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Suppress warning about table not existing:</span>
        <span class="k">with</span> <span class="n">no_warn_no_table</span><span class="p">():</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DROP TABLE IF EXISTS </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tableName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In pymysql_utils dropTable(): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">ProgrammingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In pymysql_utils dropTable(): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.execute">
    <p>def <span class="ident">execute</span>(</p><p>self, query, doCommit=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Execute an arbitrary query, including
MySQL directives. Return value is undefined.
For SELECT queries or others that return
results from MySQL, use the query() method. 
</br>        Note: For some funky directives you get the MySQL error:
</br>            Commands out of sync; you can't run this command now 
    </br>        For those, turn doCommit to False;
</br>        <b>query</b> (<b></i>String</i></b>): query or directive</br>        <b>returns:</b> (None,None) if all went well, else a tuple: (listOrErrors, listOfWarnings)</br>        <b>return type:</b> {(None,None) | ([str],[str])}</br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.execute', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.execute" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">query</span><span class="p">,</span> <span class="n">doCommit</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>                                                                                   
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Execute an arbitrary query, including</span>
<span class="sd">    MySQL directives. Return value is undefined.</span>
<span class="sd">    For SELECT queries or others that return</span>
<span class="sd">    results from MySQL, use the query() method. </span>
<span class="sd">    &lt;/br&gt;        Note: For some funky directives you get the MySQL error:</span>
<span class="sd">    &lt;/br&gt;            Commands out of sync; you can&#39;t run this command now </span>
<span class="sd">        &lt;/br&gt;        For those, turn doCommit to False;</span>
<span class="sd">    &lt;/br&gt;        &lt;b&gt;query&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): query or directive&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; (None,None) if all went well, else a tuple: (listOrErrors, listOfWarnings)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ([str],[str])}&lt;/br&gt;        &#39;&#39;&#39;</span>
    
    <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cursor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>                                                                        
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>                                                                                                   
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                <span class="c1"># Eat any query results and discard them:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># The following show_warnings() will</span>
                <span class="c1"># reveal the error:</span>
                <span class="k">pass</span>
    <span class="k">finally</span><span class="p">:</span>                                                                                               
        <span class="k">if</span> <span class="n">doCommit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># If the above MySQL call had an error,</span>
            <span class="c1"># it will generate an exception when </span>
            <span class="c1"># close the cursor. But that error info</span>
            <span class="c1"># will be caught in the show_warnings()</span>
            <span class="c1"># below; so ignore it here:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
        <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.executeParameterized">
    <p>def <span class="ident">executeParameterized</span>(</p><p>self, query, params)</p>
    </div>
    

    
  
    <div class="desc"><p>Executes arbitrary query that is parameterized
        as in the Python string format statement. Ex:
        executeParameterized('SELECT %s FROM myTable', ('col1', 'col3'))
        </br>        Return value is undefined. For SELECT queries or others that return
        results from MySQL, use the query() method.      <br />
</br>        Note: params must be a tuple. Example: to update a column:: 
        mysqldb.executeParameterized("UPDATE myTable SET col1=%s", (myVal,))
        the comma after 'myVal' is mandatory; it indicates that the 
        expression is a tuple.
</br>        <b>query</b> (<b></i>string</i></b>): query with parameter placeholder</br>        <b>params</b> (<b></i>(<any>)</i></b>): tuple of actuals for the parameters.</br>        <b>returns:</b> (None,None) if all ok, else tuple: (errorList, warningsList)</br>        <b>return type:</b> {(None,None) | ([str],[str])}</br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.executeParameterized', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.executeParameterized" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">executeParameterized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">query</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>                                                                      
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Executes arbitrary query that is parameterized</span>
<span class="sd">    as in the Python string format statement. Ex:</span>
<span class="sd">    executeParameterized(&#39;SELECT %s FROM myTable&#39;, (&#39;col1&#39;, &#39;col3&#39;))</span>
<span class="sd">    &lt;/br&gt;        Return value is undefined. For SELECT queries or others that return</span>
<span class="sd">    results from MySQL, use the query() method.        </span>
<span class="sd">&gt;        Note: params must be a tuple. Example: to update a column:: </span>
<span class="sd">    mysqldb.executeParameterized(&quot;UPDATE myTable SET col1=%s&quot;, (myVal,))</span>
<span class="sd">    the comma after &#39;myVal&#39; is mandatory; it indicates that the </span>
<span class="sd">    expression is a tuple.</span>
<span class="sd">&gt;        &lt;b&gt;query&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;string&lt;/i&gt;&lt;/b&gt;): query with parameter placeholder&lt;/br&gt;        &lt;b&gt;params&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;(&lt;any&gt;)&lt;/i&gt;&lt;/b&gt;): tuple of actuals for the parameters.&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; (None,None) if all ok, else tuple: (errorList, warningsList)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ([str],[str])}&lt;/br&gt;        &#39;&#39;&#39;</span>
    <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cursor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>                                                                        
    <span class="k">try</span><span class="p">:</span>                                                                                                   
        <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># The following show_warnings() will</span>
                <span class="c1"># reveal the error:</span>
                <span class="k">pass</span>
        <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
            <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>                                                                                                                                                                          
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.insert">
    <p>def <span class="ident">insert</span>(</p><p>self, tblName, colnameValueDict)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a dictionary mapping column names to column values,
        insert the data into a specified table
</br>        <b>tblName</b> (<b></i>String</i></b>): name of table to insert into</br>        <b>colnameValueDict</b> (<b></i>Dict<String,Any></i></b>): mapping of column name to column value</br>        <b>returns:</b> (None,None) if all ok, else tuple (errorList, warningsList)</br>        <b>return type:</b> {(None,None) | ({ (str) | None},{ (str) | None})}</br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.insert', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.insert" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tblName</span><span class="p">,</span> <span class="n">colnameValueDict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given a dictionary mapping column names to column values,</span>
<span class="sd">    insert the data into a specified table</span>
<span class="sd">&gt;        &lt;b&gt;tblName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of table to insert into&lt;/br&gt;        &lt;b&gt;colnameValueDict&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;Dict&lt;String,Any&gt;&lt;/i&gt;&lt;/b&gt;): mapping of column name to column value&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; (None,None) if all ok, else tuple (errorList, warningsList)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ({ (str) | None},{ (str) | None})}&lt;/br&gt;        &#39;&#39;&#39;</span>
    <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colNames</span><span class="p">,</span> <span class="n">colValues</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">colnameValueDict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">wellTypedColValues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensureSQLTyping</span><span class="p">(</span><span class="n">colValues</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;INSERT INTO </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">) VALUES (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tblName</span><span class="p">),</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">colNames</span><span class="p">),</span> <span class="n">wellTypedColValues</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># The following show_warnings() will</span>
                <span class="c1"># reveal the error:</span>
                <span class="k">pass</span>
        <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
            <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>                
    <span class="k">finally</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>            
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.isOpen">
    <p>def <span class="ident">isOpen</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns True if the connection to the databases
is open.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.isOpen', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.isOpen" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">isOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns True if the connection to the databases</span>
<span class="sd">    is open. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">open</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.query">
    <p>def <span class="ident">query</span>(</p><p>self, queryStr)</p>
    </div>
    

    
  
    <div class="desc"><p>Query iterator. Given a query, return one result for each
        subsequent call. When all results have been retrieved,
        the iterator returns None.
        </br>        IMPORTANT: what is returned is an <em>iterator</em>. So you
        need to call next() to get the first result, even if
        there is only one.
</br>        <b>queryStr</b> (<b></i>String</i></b>): the query to submit to MySQL</br>        <b>returns:</b> iterator of query results</br>        <b>return type:</b> iterator of tuples</br>        <b>raises:</b> ValueError on MySQL errors.</br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.query', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.query" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryStr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Query iterator. Given a query, return one result for each</span>
<span class="sd">    subsequent call. When all results have been retrieved,</span>
<span class="sd">    the iterator returns None.</span>
<span class="sd">    &lt;/br&gt;        IMPORTANT: what is returned is an *iterator*. So you</span>
<span class="sd">    need to call next() to get the first result, even if</span>
<span class="sd">    there is only one.</span>
<span class="sd">&gt;        &lt;b&gt;queryStr&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): the query to submit to MySQL&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; iterator of query results&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; iterator of tuples&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError on MySQL errors.&lt;/br&gt;        &#39;&#39;&#39;</span>
    <span class="c1"># The str/byte/unicode type mess between</span>
    <span class="c1"># Python 2.7 and 3.x. We want as &#39;normal&#39;</span>
    <span class="c1"># a string as possible. Surely there is a</span>
    <span class="c1"># more elegant way:</span>
    
    <span class="n">queryStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_string</span><span class="p">(</span><span class="n">queryStr</span><span class="p">)</span>
   
    <span class="c1"># For if caller never exhausts the results by repeated calls,</span>
    <span class="c1"># and to find cursor by query to get (e.g.) num results:</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    
    <span class="c1"># Ability to find an active cursor by query </span>
    <span class="c1"># via result_count(queryString)...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="n">queryStr</span><span class="p">]</span> <span class="o">=</span> <span class="n">cursor</span>
    
    <span class="c1">#... or find it via  result_count()...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">most_recent_query</span> <span class="o">=</span> <span class="n">queryStr</span>
    <span class="k">try</span><span class="p">:</span>        
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">queryStr</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ProgrammingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">QueryResult</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">queryStr</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.query_exhausted">
    <p>def <span class="ident">query_exhausted</span>(</p><p>self, cursor)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.query_exhausted', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.query_exhausted" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">query_exhausted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
    <span class="c1"># Delete the cursor&#39;s entry in the </span>
    <span class="c1"># cursors { queryStr --&gt; cursor } dict.</span>
    <span class="c1"># Since there will be few entries, the</span>
    <span class="c1"># following dictionary scan isn&#39;t a problem:</span>

    <span class="n">cursors_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">the_cursor</span> <span class="ow">in</span> <span class="n">cursors_copy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">the_cursor</span> <span class="o">==</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="n">query_str</span><span class="p">]</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.result_count">
    <p>def <span class="ident">result_count</span>(</p><p>self, queryStr=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a query string, after that string served
as query in a call to query(), and before the result iterator
has been exhausted: return number of SELECT results.
</br>        If queryStr is left to None, the value of 
self.most_recent_query is used.
</br>        <b>queryStr</b> (<b></i>{None | string}</i></b>): query that was used in a prior call to query()</br>        <b>returns:</b> number of records in SELECT result.</br>        <b>return type:</b> int</br>        <b>raises:</b> ValueError if no prior query is still active.</br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.result_count', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.result_count" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">result_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryStr</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given a query string, after that string served</span>
<span class="sd">    as query in a call to query(), and before the result iterator</span>
<span class="sd">    has been exhausted: return number of SELECT results.</span>
<span class="sd">    &lt;/br&gt;        If queryStr is left to None, the value of </span>
<span class="sd">    self.most_recent_query is used.</span>
<span class="sd">    &lt;/br&gt;        &lt;b&gt;queryStr&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;{None | string}&lt;/i&gt;&lt;/b&gt;): query that was used in a prior call to query()&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; number of records in SELECT result.&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; int&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError if no prior query is still active.&lt;/br&gt;        &#39;&#39;&#39;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">queryStr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_recent_query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">most_recent_query</span><span class="p">]</span><span class="o">.</span><span class="n">rowcount</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No previous query available.&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="n">queryStr</span><span class="p">]</span><span class="o">.</span><span class="n">rowcount</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query &#39;</span><span class="si">%s</span><span class="s2">&#39; is no longer active.&quot;</span> <span class="o">%</span> <span class="n">queryStr</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.truncateTable">
    <p>def <span class="ident">truncateTable</span>(</p><p>self, tableName)</p>
    </div>
    

    
  
    <div class="desc"><p>Delete all table rows. No errors
</br>        <b>tableName</b> (<b></i>String</i></b>): name of table</br>        <b>raises:</b> ValueError: if table to truncate does not exist or permissions issues.</br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.truncateTable', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.truncateTable" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">truncateTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableName</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Delete all table rows. No errors</span>
<span class="sd">&gt;        &lt;b&gt;tableName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of table&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError: if table to truncate does not exist or permissions issues.&lt;/br&gt;        &#39;&#39;&#39;</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;TRUNCATE TABLE </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tableName</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In pymysql_utils truncateTable(): </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ProgrammingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;In pymysql_utils truncateTable(): </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.update">
    <p>def <span class="ident">update</span>(</p><p>self, tblName, colName, newVal, fromCondition=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Update one column with a new value.
</br>        <b>tblName</b> (<b></i>String</i></b>): name of table in which update is to occur</br>        <b>colName</b> (<b></i>String</i></b>): column whose value is to be changed</br>        <b>newVal</b> (<b></i>type acceptable to MySQL for the given column</i></b>): value acceptable to MySQL for the given column</br>        <b>fromCondition</b> (<b></i>String</i></b>): optionally condition that selects which rows to update. if None, the named column in all rows are updated to the given value. Syntax must conform to what may be in a MySQL FROM clause (don't include the 'FROM' keyword)</br>        <b>returns:</b> (None,None) if all ok, else tuple (errorList, warningsList)</br>        <b>return type:</b> {(None,None) | ([str],[str])}</br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.update', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.update" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tblName</span><span class="p">,</span> <span class="n">colName</span><span class="p">,</span> <span class="n">newVal</span><span class="p">,</span> <span class="n">fromCondition</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Update one column with a new value.</span>
<span class="sd">&gt;        &lt;b&gt;tblName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): name of table in which update is to occur&lt;/br&gt;        &lt;b&gt;colName&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): column whose value is to be changed&lt;/br&gt;        &lt;b&gt;newVal&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;type acceptable to MySQL for the given column&lt;/i&gt;&lt;/b&gt;): value acceptable to MySQL for the given column&lt;/br&gt;        &lt;b&gt;fromCondition&lt;/b&gt; (&lt;b&gt;&lt;/i&gt;String&lt;/i&gt;&lt;/b&gt;): optionally condition that selects which rows to update. if None, the named column in all rows are updated to the given value. Syntax must conform to what may be in a MySQL FROM clause (don&#39;t include the &#39;FROM&#39; keyword)&lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; (None,None) if all ok, else tuple (errorList, warningsList)&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; {(None,None) | ([str],[str])}&lt;/br&gt;        &#39;&#39;&#39;</span>
    <span class="n">errors</span>   <span class="o">=</span> <span class="p">[]</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fromCondition</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">newVal</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c1"># The double-% causes the &#39;%s&#39; to be retained</span>
                <span class="c1"># in the update string. The underlying mysqldb</span>
                <span class="c1"># package will substitute that later for None.</span>
                <span class="c1"># I.e.: create a two-tuple:</span>
                <span class="c1">#</span>
                <span class="c1">#   (&#39;UPDATE unittest SET col1 = %s&#39;, (None,))</span>
                <span class="c1">#</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;UPDATE </span><span class="si">%s</span><span class="s2"> SET </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%%</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tblName</span><span class="p">,</span><span class="n">colName</span><span class="p">),</span> <span class="p">(</span><span class="bp">None</span><span class="p">,))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;UPDATE </span><span class="si">%s</span><span class="s2"> SET </span><span class="si">%s</span><span class="s2"> = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tblName</span><span class="p">,</span><span class="n">colName</span><span class="p">,</span><span class="n">newVal</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">newVal</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c1"># See above for explanation of double-%:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;UPDATE </span><span class="si">%s</span><span class="s2"> SET </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%%</span><span class="s2">s WHERE </span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tblName</span><span class="p">,</span><span class="n">colName</span><span class="p">,</span><span class="n">fromCondition</span><span class="p">),</span> <span class="p">(</span><span class="bp">None</span><span class="p">,))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;UPDATE </span><span class="si">%s</span><span class="s2"> SET </span><span class="si">%s</span><span class="s2"> = &#39;</span><span class="si">%s</span><span class="s2">&#39; WHERE </span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tblName</span><span class="p">,</span><span class="n">colName</span><span class="p">,</span><span class="n">newVal</span><span class="p">,</span><span class="n">fromCondition</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">no_db_warnings</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># If setting to None, cmd will be a tuple</span>
                <span class="c1"># with the %s-notation UPDATE string first,</span>
                <span class="c1"># and the values second:</span>
                <span class="k">if</span> <span class="n">newVal</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># The following show_warnings() will</span>
                <span class="c1"># reveal the error:</span>
                <span class="k">pass</span>
        <span class="n">mysql_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">show_warnings</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span>   <span class="o">=</span> <span class="p">[</span><span class="n">warning_tuple</span> <span class="k">for</span> <span class="n">warning_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">warning_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Warning&#39;</span><span class="p">]</span>
            <span class="n">errors</span>     <span class="o">=</span> <span class="p">[</span><span class="n">error_tuple</span> <span class="k">for</span> <span class="n">error_tuple</span> <span class="ow">in</span> <span class="n">mysql_warnings</span> <span class="k">if</span> <span class="n">error_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>            
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>            
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pymysql_utilsTmp.MySQLDB.connection" class="name">var <span class="ident">connection</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.MySQLDB.cursors" class="name">var <span class="ident">cursors</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.MySQLDB.db" class="name">var <span class="ident">db</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.MySQLDB.most_recent_query" class="name">var <span class="ident">most_recent_query</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.MySQLDB.name" class="name">var <span class="ident">name</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.MySQLDB.pwd" class="name">var <span class="ident">pwd</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.MySQLDB.user" class="name">var <span class="ident">user</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.MySQLDB.find_mysql_path">
    <p>def <span class="ident">find_mysql_path</span>(</p><p>cls)</p>
    </div>
    

    
  
    <div class="desc"><p>Finds the location of the mysql client program
on the current machine. Needed for testing. So
we make sure the method works when running outside
of Eclipse as well as in.
</br>        Stores path in MySQLDB.mysql_loc.
</br>        @param cls: class instance of MySQLDB
@type cls: MySQLDB
@return: path to mysql client application
@rtype: str</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.MySQLDB.find_mysql_path', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.MySQLDB.find_mysql_path" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>            
<span class="k">def</span> <span class="nf">find_mysql_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Finds the location of the mysql client program</span>
<span class="sd">    on the current machine. Needed for testing. So</span>
<span class="sd">    we make sure the method works when running outside</span>
<span class="sd">    of Eclipse as well as in.</span>
<span class="sd">    &lt;/br&gt;        Stores path in MySQLDB.mysql_loc.</span>
<span class="sd">    &lt;/br&gt;        @param cls: class instance of MySQLDB</span>
<span class="sd">    @type cls: MySQLDB</span>
<span class="sd">    @return: path to mysql client application</span>
<span class="sd">    @rtype: str</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># The &#39;command -v mysql...&#39; idiom always returns an empty</span>
    <span class="c1"># string when probed from Eclipse. To facilitate debugging</span>
    <span class="c1"># we find an alternative method for running in Eclipse.  </span>
    
    <span class="n">mysql_loc</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Eclipse puts extra info into the env:</span>
    <span class="n">eclipse_indicator</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;XPC_SERVICE_NAME&#39;</span><span class="p">)</span>
    
    <span class="c1"># If the indicator is absent, or it doesn&#39;t include</span>
    <span class="c1"># the eclipse info, then we are not in Eclipse; the usual</span>
    <span class="c1"># case, of course:</span>
    
    <span class="k">if</span> <span class="n">eclipse_indicator</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
       <span class="n">eclipse_indicator</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span> <span class="ow">or</span> \
       <span class="n">eclipse_indicator</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;org.eclipse.platform.ide&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Not running in Eclipse; use reliable method to find mysql:</span>
        <span class="n">mysql_loc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                                    <span class="s2">&quot;command -v mysql; exit 0&quot;</span><span class="p">,</span>
                                    <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>
                                    <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                    <span class="n">env</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mysql_loc</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;MySQL client not found on this machine (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># We are in Eclipse:</span>
        <span class="n">possible_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/usr/local/bin/mysql&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;/usr/local/mysql/bin/mysql&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;/usr/bin/mysql&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;/bin/mysql&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">possible_paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">mysql_loc</span> <span class="o">=</span> <span class="n">path</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">mysql_loc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;MySQL client not found on this machine (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>
    
    <span class="n">MySQLDB</span><span class="o">.</span><span class="n">mysql_loc</span> <span class="o">=</span> <span class="n">mysql_loc</span>
    <span class="k">return</span> <span class="n">mysql_loc</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pymysql_utilsTmp.QueryResult" class="name">class <span class="ident">QueryResult</span></p>
      
  
    <div class="desc"><p>Iterator for query results. Given an instance
    of this class I, the following works as expected:
</br>        for res in I:
            print(res)
            </br>    Instances of this class are returned by MySQLDB's 
    query() method. Use next() and nextall() to get
    one result at a time, or all at once.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.QueryResult', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.QueryResult" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">QueryResult</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Iterator for query results. Given an instance</span>
<span class="sd">    of this class I, the following works as expected:</span>
<span class="sd">&lt;/br&gt;        for res in I:</span>
<span class="sd">            print(res)</span>
<span class="sd">            &lt;/br&gt;    Instances of this class are returned by MySQLDB&#39;s </span>
<span class="sd">    query() method. Use next() and nextall() to get</span>
<span class="sd">    one result at a time, or all at once.</span>
<span class="sd">    &#39;&#39;&#39;</span>
  
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">cursor_owner_obj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span> <span class="o">=</span> <span class="n">cursor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_owner</span> <span class="o">=</span> <span class="n">cursor_owner_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">the_query_str</span>    <span class="o">=</span> <span class="n">query_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exhausted</span>    <span class="o">=</span> <span class="bp">False</span>
      
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the next result in a query, </span>
<span class="sd">        or raise StopIteration if no results</span>
<span class="sd">        remain.</span>
<span class="sd">        &lt;/br&gt;        Note: Returns the zeroeth element</span>
<span class="sd">        of the result. So:</span>
<span class="sd">        `(&#39;foo&#39;,)  --&gt; &#39;foo&#39;` </span>
<span class="sd">        and </span>
<span class="sd">        `({&#39;col1&#39; : 10},) ==&gt; {&#39;col1&#39; : 10}`</span>
<span class="sd">&lt;/br&gt;        This convention is in contrast to what</span>
<span class="sd">        cursor.fetconeh() does.</span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; StopIteration&lt;/br&gt;        &#39;&#39;&#39;</span>
  
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_owner</span><span class="o">.</span><span class="n">query_exhausted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exhausted</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">()</span>            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span>
         
    <span class="n">__next__</span> <span class="o">=</span> <span class="nb">next</span>
    
    <span class="k">def</span> <span class="nf">nextall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the remaining query results as a </span>
<span class="sd">        tuple of tuples.</span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; all remaining tuples inside a wrapper tuple, or empty tuple if no results remain.&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; ((str))&lt;/br&gt;        &lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="n">all_remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># We exhausted the query, so clean up:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_owner</span><span class="o">.</span><span class="n">query_exhausted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exhausted</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="n">all_remaining</span>

    <span class="k">def</span> <span class="nf">query_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Provide query that led to this result.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">the_query_str</span>

    <span class="k">def</span> <span class="nf">result_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the number of results in this result object.</span>
<span class="sd">        &lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; number of query results&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; int&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError if query no longer active.&lt;/br&gt;        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exhausted</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query &#39;</span><span class="si">%s</span><span class="s2">&#39; is no longer active.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_str</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="o">.</span><span class="n">rowcount</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pymysql_utilsTmp.QueryResult">QueryResult</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.QueryResult.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, cursor, query_str, cursor_owner_obj)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.QueryResult.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.QueryResult.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">query_str</span><span class="p">,</span> <span class="n">cursor_owner_obj</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span> <span class="o">=</span> <span class="n">cursor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cursor_owner</span> <span class="o">=</span> <span class="n">cursor_owner_obj</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">the_query_str</span>    <span class="o">=</span> <span class="n">query_str</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exhausted</span>    <span class="o">=</span> <span class="bp">False</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.QueryResult.next">
    <p>def <span class="ident">next</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the next result in a query, 
        or raise StopIteration if no results
        remain.
        </br>        Note: Returns the zeroeth element
        of the result. So:
        <code>('foo',)  --&gt; 'foo'</code> 
        and 
        <code>({'col1' : 10},) ==&gt; {'col1' : 10}</code>
</br>        This convention is in contrast to what
        cursor.fetconeh() does.
        </br>        <b>raises:</b> StopIteration</br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.QueryResult.next', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.QueryResult.next" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return the next result in a query, </span>
<span class="sd">    or raise StopIteration if no results</span>
<span class="sd">    remain.</span>
<span class="sd">    &lt;/br&gt;        Note: Returns the zeroeth element</span>
<span class="sd">    of the result. So:</span>
<span class="sd">    `(&#39;foo&#39;,)  --&gt; &#39;foo&#39;` </span>
<span class="sd">    and </span>
<span class="sd">    `({&#39;col1&#39; : 10},) ==&gt; {&#39;col1&#39; : 10}`</span>
<span class="sd">&gt;        This convention is in contrast to what</span>
<span class="sd">    cursor.fetconeh() does.</span>
<span class="sd">    &lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; StopIteration&lt;/br&gt;        &#39;&#39;&#39;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_owner</span><span class="o">.</span><span class="n">query_exhausted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exhausted</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">()</span>            
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.QueryResult.nextall">
    <p>def <span class="ident">nextall</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the remaining query results as a 
tuple of tuples.
</br>        <b>returns:</b> all remaining tuples inside a wrapper tuple, or empty tuple if no results remain.</br>        <b>return type:</b> ((str))</br>        </br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.QueryResult.nextall', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.QueryResult.nextall" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">nextall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the remaining query results as a </span>
<span class="sd">    tuple of tuples.</span>
<span class="sd">    &lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; all remaining tuples inside a wrapper tuple, or empty tuple if no results remain.&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; ((str))&lt;/br&gt;        &lt;/br&gt;        &#39;&#39;&#39;</span>
    <span class="n">all_remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="c1"># We exhausted the query, so clean up:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cursor_owner</span><span class="o">.</span><span class="n">query_exhausted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exhausted</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">all_remaining</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.QueryResult.query_str">
    <p>def <span class="ident">query_str</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Provide query that led to this result.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.QueryResult.query_str', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.QueryResult.query_str" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">query_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Provide query that led to this result.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">the_query_str</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pymysql_utilsTmp.QueryResult.result_count">
    <p>def <span class="ident">result_count</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the number of results in this result object.
</br>        <b>returns:</b> number of query results</br>        <b>return type:</b> int</br>        <b>raises:</b> ValueError if query no longer active.</br></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pymysql_utilsTmp.QueryResult.result_count', this);">Show source &equiv;</a></p>
  <div id="source-pymysql_utilsTmp.QueryResult.result_count" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">result_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return the number of results in this result object.</span>
<span class="sd">    &lt;/br&gt;        &lt;b&gt;returns:&lt;/b&gt; number of query results&lt;/br&gt;        &lt;b&gt;return type:&lt;/b&gt; int&lt;/br&gt;        &lt;b&gt;raises:&lt;/b&gt; ValueError if query no longer active.&lt;/br&gt;        &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exhausted</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query &#39;</span><span class="si">%s</span><span class="s2">&#39; is no longer active.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_str</span><span class="p">())</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mysql_cursor</span><span class="o">.</span><span class="n">rowcount</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pymysql_utilsTmp.QueryResult.cursor_owner" class="name">var <span class="ident">cursor_owner</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.QueryResult.exhausted" class="name">var <span class="ident">exhausted</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.QueryResult.mysql_cursor" class="name">var <span class="ident">mysql_cursor</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pymysql_utilsTmp.QueryResult.the_query_str" class="name">var <span class="ident">the_query_str</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
